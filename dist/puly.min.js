/*!
 * puly - 一个简单易用的3D图表，像ECharts一样可以快速上手，配置化生成，并支持个性化自定义扩展。
 * git+https://github.com/hai2007/puly.git
 *
 * author 你好2007 < https://hai2007.gitee.io/sweethome >
 *
 * version 1.0.0-beta.2
 *
 * Copyright (c) 2021-2022 hai2007 走一步，再走一步。
 * Released under the MIT license
 *
 * Date:Tue May 03 2022 21:12:43 GMT+0800 (GMT+08:00)
 */
(function(){"use strict";function t(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){t=function(e){return typeof e}}else{t=function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return t(e)}function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}function e(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);return e}function f(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function u(e){return i(e)||o(e)||s(e)||l()}function i(e){if(Array.isArray(e))return a(e)}function o(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function s(e,t){if(!e)return;if(typeof e==="string")return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}function a(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function l(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function d(e,t){var r=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=s(e))||t&&e&&typeof e.length==="number"){if(r)e=r;var n=0;var i=function(){};return{s:i,n:function(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,a=false,f;return{s:function(){r=r.call(e)},n:function(){var e=r.next();o=e.done;return e},e:function(e){a=true;f=e},f:function(){try{if(!o&&r.return!=null)r.return()}finally{if(a)throw f}}}}var c={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};var h={stopPropagation:function(e){e=e||window.event;if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}},preventDefault:function(e){e=e||window.event;if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},isNode:function(e){return e&&(e.nodeType===1||e.nodeType===9||e.nodeType===11)},bind:function(e,t,r){if(e.constructor===Array||e.constructor===NodeList||e.constructor===HTMLCollection){for(var n=0;n<e.length;n++){this.bind(e[n],t,r)}return}if(window.attachEvent)e.attachEvent("on"+t,r);else e.addEventListener(t,r,false)},unbind:function(e,t,r){if(e.constructor===Array||e.constructor===NodeList||e.constructor===HTMLCollection){for(var n=0;n<e.length;n++){this.unbind(e[n],t,r)}return}if(window.detachEvent)e.detachEvent("on"+t,r);else e.removeEventListener(t,r,false)},find:function(e,t,r){if(!this.isNode(e))return[];var n=e.getElementsByTagName(r||"*");var i=[];for(var o=0;o<n.length;o++){if(this.isNode(n[o])&&(typeof t!="function"||t(n[o])))i.push(n[o])}return i},children:function(e,t){var r=e.childNodes;var n=[];for(var i=0;i<r.length;i++){if(this.isNode(r[i])&&(typeof t!="function"||t(r[i])))n.push(r[i])}return n},hasClass:function(e,t,r){if(t.constructor!==Array)t=[t];var n=" "+(e.getAttribute("class")||"")+" ";for(var i=0;i<t.length;i++){if(n.indexOf(" "+t[i]+" ")>=0){if(r)return true}else{if(!r)return false}}return true},removeClass:function(e,t){var r=" "+(e.getAttribute("class")||"")+" ";var n=r.replace(" "+t.trim()+" "," ");e.setAttribute("class",n.trim())},addClass:function(e,t){if(this.hasClass(e,t))return;var r=e.getAttribute("class")||"";e.setAttribute("class",r+" "+t)},toNode:function(e,t){var r;if(t)r=document.createElementNS(c.svg,"svg");else{var n="div";if(/^<tr[> ]/.test(e)){n="tbody"}else if(/^<th[> ]/.test(e)||/^<td[> ]/.test(e)){n="tr"}else if(/^<thead[> ]/.test(e)||/^<tbody[> ]/.test(e)){n="table"}r=document.createElement(n)}r.innerHTML=e;var i=r.childNodes;for(var o=0;o<i.length;o++){if(this.isNode(i[o]))return i[o]}},trigger:function(e,t){if(document.createEventObject){e.fireEvent("on"+t,document.createEventObject())}else{var r=document.createEvent("HTMLEvents");r.initEvent(t,true,false);e.dispatchEvent(r)}},getStyle:function(e,t){var r=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null):e.currentStyle;return typeof t==="string"?r.getPropertyValue(t):r},offsetPosition:function(e){var t=0;var r=0;r=e.offsetTop;t=e.offsetLeft;e=e.offsetParent;while(e){r+=e.offsetTop;t+=e.offsetLeft;e=e.offsetParent}return{left:t,top:r}},mousePosition:function(e,t){var r=e.getBoundingClientRect();if(!t||!t.clientX)throw new Error("Event is necessary!");return{x:t.clientX-r.left,y:t.clientY-r.top}},remove:function(e){e.parentNode.removeChild(e)},setStyles:function(e,t){for(var r in t)e.style[r]=t[r]},size:function(e,t){var r,n;if(t=="content"){n=e.clientWidth-(this.getStyle(e,"padding-left")+"").replace("px","")-(this.getStyle(e,"padding-right")+"").replace("px","");r=e.clientHeight-(this.getStyle(e,"padding-top")+"").replace("px","")-(this.getStyle(e,"padding-bottom")+"").replace("px","")}else if(t=="padding"){n=e.clientWidth;r=e.clientHeight}else if(t=="border"){n=e.offsetWidth;r=e.offsetHeight}else if(t=="scroll"){n=e.scrollWidth;r=e.scrollHeight}else{n=e.offsetWidth;r=e.offsetHeight}return{width:n,height:r}},append:function(e,t){var r=this.isNode(t)?t:this.toNode(t);e.appendChild(r);return r},prepend:function(e,t){var r=this.isNode(t)?t:this.toNode(t);e.insertBefore(r,e.childNodes[0]);return r},after:function(e,t){var r=this.isNode(t)?t:this.toNode(t);e.parentNode.insertBefore(r,e.nextSibling);return r},before:function(e,t){var r=this.isNode(t)?t:this.toNode(t);e.parentNode.insertBefore(r,e);return r}};var v=true;function p(e,r){var t=null;var n=false;var i=false;var o=function e(){if(!n){n=true;var t=window.setInterval(function(){if(!i){window.clearInterval(t);n=false;r()}i=false},100)}else{i=true}};try{t=new ResizeObserver(o);t.observe(e)}catch(e){if(v){console.error("ResizeObserver undefined!");v=false}o();window.addEventListener("resize",o,false)}return function(){if(t){t.disconnect()}}}var m={whitespace:"[\\x20\\t\\r\\n\\f]"};function g(e,t){var r=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null):e.currentStyle;return typeof t==="string"?r.getPropertyValue(t):r}function y(e){var t=document.getElementsByTagName("head")[0];t.style["color"]=e;var r=g(t,"color");var n=r.replace(/^rgba?\(([^)]+)\)$/,"$1").split(new RegExp("\\,"+m.whitespace));return[+n[0],+n[1],+n[2],n[3]==undefined?1:+n[3]]}var b=function(e){var t={colors:[]};if("colors"in e){var r=d(e.colors),n;try{for(r.s();!(n=r.n()).done;){var i=n.value;var o=y(i);t.colors.push([o[0]/255,o[1]/255,o[2]/255,o[3]])}}catch(e){r.e(e)}finally{r.f()}}return t};function w(e){var t=typeof e;return e!=null&&(t==="object"||t==="function")}var E=Object.prototype.toString;function x(e){if(e==null){return e===undefined?"[object Undefined]":"[object Null]"}return E.call(e)}function A(e){var t=typeof e;return t==="string"||t==="object"&&e!=null&&!Array.isArray(e)&&x(e)==="[object String]"}var _=w;var T=A;var S=function(e){return Array.isArray(e)};var L={blankReg:new RegExp("[\\x20\\t\\r\\n\\f]"),blanksReg:/^[\x20\t\r\n\f]{0,}$/,identifier:/^[a-zA-Z_$][0-9a-zA-Z_$]{0,}$/};var N=["+","-","*","/","%","&","|","!","?",":","[","]","(",")",">","<","="];var P=["+","-","*","/","%","&","|","!","?",":",">","<","=","<=",">=","==","===","!=","!=="];function U(e,t,r){t=t.trim();var n=-1,i=null;var o=function(){i=n++<t.length-1?t[n]:null;return i};var a=function(e){return t.substring(n,e+n>t.length?t.length:e+n)};o();var f=[];while(true){if(n>=t.length)break;if(N.indexOf(i)>-1){if(["&","|","="].indexOf(i)>-1){if(["==="].indexOf(a(3))>-1){f.push(a(3));n+=2;o()}else if(["&&","||","=="].indexOf(a(2))>-1){f.push(a(2));n+=1;o()}else{throw new Error("Illegal expression : "+t+"\nstep='analyseExpress',index="+n)}}else{if(["!=="].indexOf(a(3))>-1){f.push(a(3));n+=2;o()}else if([">=","<=","!="].indexOf(a(2))>-1){f.push(a(2));n+=1;o()}else{f.push(i);o()}}}else if(['"',"'"].indexOf(i)>-1){var u="",s=i;o();while(i!=s){if(n>=t.length){throw new Error("String unclosed error : "+t+"\nstep='analyseExpress',index="+n)}u+=i;o()}f.push(u+"@string");o()}else if(/\d/.test(i)){var l="no";var u=i;o();while(n<t.length){if(/\d/.test(i)){u+=i;if(l=="error")l="yes"}else if("."==i&&l=="no"){u+=i;l="error"}else{break}o()}if(l=="error")u+="0";f.push(+u)}else if(["null","true"].indexOf(a(4))>-1){f.push({null:null,true:true}[a(4)]);n+=3;o()}else if(["false"].indexOf(a(5))>-1){f.push({false:false}[a(5)]);n+=4;o()}else if(["undefined"].indexOf(a(9))>-1){f.push({undefined:undefined}[a(9)]);n+=8;o()}else if(L.blankReg.test(i)){do{o()}while(L.blankReg.test(i)&&n<t.length)}else{var c=false;if(i=="."){c=true;o()}if(L.identifier.test(i)){var v=1;while(n+v<=t.length&&L.identifier.test(a(v)))v+=1;if(c){f.push("[");f.push(a(v-1)+"@string");f.push("]")}else{var h=a(v-1);var d=h in r?r[h]:e[h];f.push(T(d)?d+"@string":d)}n+=v-2;o()}else{throw new Error("Illegal express : "+t+"\nstep='analyseExpress',index="+n)}}}var p=0;for(var m=0;m<f.length;m++){if(["+","-"].indexOf(f[m])>-1&&(m==0||P.indexOf(f[p-1])>-1)){f[p++]=+(f[m]+f[m+1]);m+=1}else{f[p++]=f[m]}}f.length=p;return f}var R=function(e){if(typeof e=="string")return e.replace(/@string$/,"");return e};var I=function(e){if(typeof e=="string")return e+"@string";return e};function M(e){var t=0,r=0;for(;r<e.length;r++){if(e[r]=="!"){e[t]=!e[++r]}else e[t]=e[r];t+=1}if(t==1)return R(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="*"){e[t-1]=R(e[t-1])*R(e[++r])}else if(e[r]=="/"){e[t-1]=R(e[t-1])/R(e[++r])}else if(e[r]=="%"){e[t-1]=R(e[t-1])%R(e[++r])}else{e[t++]=e[r]}}if(t==1)return R(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="+"){e[t-1]=I(R(e[t-1])+R(e[++r]))}else if(e[r]=="-"){e[t-1]=R(e[t-1])-R(e[++r])}else e[t++]=e[r]}if(t==1)return R(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]==">"){e[t-1]=R(e[t-1])>R(e[++r])}else if(e[r]=="<"){e[t-1]=R(e[t-1])<R(e[++r])}else if(e[r]=="<="){e[t-1]=R(e[t-1])<=R(e[++r])}else if(e[r]==">="){e[t-1]=R(e[t-1])>=R(e[++r])}else e[t++]=e[r]}if(t==1)return R(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="=="){e[t-1]=R(e[t-1])==R(e[++r])}else if(e[r]=="==="){e[t-1]=R(e[t-1])===R(e[++r])}else if(e[r]=="!="){e[t-1]=R(e[t-1])!=R(e[++r])}else if(e[r]=="!=="){e[t-1]=R(e[t-1])!==R(e[++r])}else e[t++]=e[r]}if(t==1)return R(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="&&"){e[t-1]=R(e[t-1])&&R(e[1+r]);r+=1}else if(e[r]=="||"){e[t-1]=R(e[t-1])||R(e[1+r]);r+=1}else e[t++]=e[r]}if(t==1)return R(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="?"){e[t-1]=R(e[t-1])?R(e[r+1]):R(e[r+3]);r+=3}else e[t++]=e[r]}if(t==1)return R(e[0]);e.length=t;throw new Error("Unrecognized expression : ["+e.toString()+"]")}function B(t,r,n){var e=r[0]in n?n[r[0]]:t[r[0]];for(var i=1;i<r.length;i++){try{e=e[r[i]]}catch(e){console.error({target:t,scope:n,expressArray:r,index:i});throw e}}return e}var O=function(e,t,r){if(t.indexOf("(")>-1){var n=[],i=[],o=0;for(var a=0;a<t.length;a++){if(t[a]=="("){if(o>0){i.push("(")}o+=1}else if(t[a]==")"){if(o>1)i.push(")");o-=1;if(o==0){var f=M(O(e,i));n.push(T(f)?f+"@string":f);i=[]}}else{if(o>0)i.push(t[a]);else n.push(t[a])}}t=n}return C(t)};var C=function(e){var t=true;while(t){t=false;var r=[],n=[],i=false;for(var o=0;o<e.length;o++){if(e[o]=="["&&o!=0&&e[o-1]!="]"){if(i){r.push("[");for(var a=0;a<n.length;a++)r.push(n[a])}else{i=true}n=[]}else if(e[o]=="]"&&i){t=true;var f=M(n);var u=r[r.length-1][f];r[r.length-1]=T(u)?u+"@string":u;i=false}else{if(i){n.push(e[o])}else{r.push(e[o])}}}e=r}return e};var k=function(e){var t=[],r=[];for(var n=0;n<e.length;n++){if(e[n]=="["){r=[]}else if(e[n]=="]"){t.push(M(r))}else{r.push(e[n])}}return t};function z(e,t,r){var n=O(e,t);var i;if(n[0]!="["){i=[M(n)]}else if(n[n.length-1]=="]"){i=k(n)}else{var o=n.lastIndexOf("]");var a=k(n.slice(0,o+1));var f=n.slice(o+1);f.unshift(B(e,a,r));i=[M(f)]}return i}var D=function(e,t,r){if(arguments.length<3)r={};var n=U(e,t,r);var i=z(e,n,r);return B(e,i,r)};var F=function(e,t,r,n){if(arguments.length<4)n={};var i=U(e,t,n);var o=z(e,i,n);var a=e;for(var f=0;f<o.length-1;f++){if(!(o[f]in a))a[o[f]]=S(a)?[]:{};a=a[o[f]]}a[o[o.length-1]]=r;return e};function j(o,e){(function e(t,r){for(var n in r){var i=t+"['"+n+"']";if(_(r[n])&&!S(r[n])){if(!D(o,i)){F(o,i,{})}e(i,r[n])}else{F(o,i,r[n])}}})("",e);return o}function G(e,t){return t={exports:{}},e(t,t.exports),t.exports}var X=G(function(a){(function(){function t(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){t=function(e){return typeof e}}else{t=function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return t(e)}var r=Object.prototype.toString;function n(e){if(e==null){return e===undefined?"[object Undefined]":"[object Null]"}return r.call(e)}function e(e){return typeof e==="number"||e!==null&&t(e)==="object"&&n(e)==="[object Number]"}var i=e;var l={splitNum:function e(t,r){var n=Math.ceil(Math.PI*2/Math.asin(t/r)*2);return isNaN(n)||n<12?12:n}};function h(e,t,r,n,i){var o=Math.cos(r),a=Math.sin(r);return[(n-e)*o-(i-t)*a+e,(n-e)*a+(i-t)*o+t]}function c(e,t,r,n,i){var o,a;if(i==4){var f=n/1.414;o=e+f;a=r+f}else{o=e+n;a=r}var u=[e,t,r,o,t,a],s=Math.PI*2/i;for(var l=0;l<i;l++){var c=h(e,r,s*(l+1),o,a);u.push(c[0],t,c[1])}return u}function v(e,t,r,n,i,o){var a,f;if(o==4){var u=n/1.414;a=e+u;f=r+u}else{a=e+n;f=r}var s=[a,t,f,a,t+i,f],l=Math.PI*2/o;for(var c=0;c<o;c++){var v=h(e,r,l*(c+1),a,f);s.push(v[0],t,v[1],v[0],t+i,v[1])}return s}function d(e,t,r,n,i,o){var a=[e,t+n,r],f=Math.PI*2/i,u;for(var s=1;s<i*.5;s++){u=h(e,t,f*s,e,t+n);var l=h(e,r,f*o,u[0],r);a.push(l[0],u[1],l[1]);var c=h(e,r,f*(o+1),u[0],r);a.push(c[0],u[1],c[1])}a.push(e,t-n,r);return a}var o=function e(u){if(!i(u.precision)||u<=0){throw new Error("options.precision should be an integer greater than zero")}var s={cylinder:function e(t,r,n,i,o,a){var f=l.splitNum(u.precision,o);s.prism(t,r,n,i,o,a,f);return s},prism:function e(t,r,n,i,o,a,f){t({points:c(r,n,i,o,f),length:f+2,methods:"FanTriangle"});t({points:c(r,n+a,i,o,f),length:f+2,methods:"FanTriangle"});t({points:v(r,n,i,o,a,f),length:2*f+2,methods:"StripTriangle"});return s},sphere:function e(t,r,n,i,o){var a=l.splitNum(u.precision,o);for(var f=0;f<a;f++){t({points:d(r,n,i,o,a,f),length:a+1,methods:"StripTriangle"})}return s}};return s};if(t(a)==="object"&&t(a.exports)==="object"){a.exports=o}else{window.ThreeGeometry=o}})()});var V=function(e,t){var r=X({precision:1});var n=0;var i=0;var o=d(e),a;try{for(o.s();!(a=o.n()).done;){var f=a.value;if(f.type=="item"){if(f.name=="cuboid"){var u=Math.abs(f.start+f.length);var s=Math.max(Math.abs(Math.ceil(f.index+f.size*.5)),Math.abs(Math.floor(f.index-f.size*.5)));n=Math.max(n,u);i=Math.max(i,s)}}}}catch(e){o.e(e)}finally{o.f()}var l=[];var c=d(e),v;try{var h=function e(){var t=v.value;if(t.type=="item"){if(t.name=="cuboid"){r.prism(function(e){l.push({data:e,color:t.color})},t.index/i,t.start/n,0,1/i*t.size/2,t.length/n,4)}}};for(c.s();!(v=c.n()).done;){h()}}catch(e){c.e(e)}finally{c.f()}return{geometry:l}};var H=G(function(I){var M=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){var f=function e(t,r,n){var i=t.createShader(r);if(i==null)throw new Error("Unable to create shader!");t.shaderSource(i,n);t.compileShader(i);if(!t.getShaderParameter(i,t.COMPILE_STATUS))throw new Error("Failed to compile shader:"+t.getShaderInfoLog(i));return i};var o=function e(t,r,n){var i=f(t,t.VERTEX_SHADER,r),o=f(t,t.FRAGMENT_SHADER,n);var a=t.createProgram();t.attachShader(a,i);t.attachShader(a,o);t.linkProgram(a);if(!t.getProgramParameter(a,t.LINK_STATUS))throw new Error("Failed to link program: "+t.getProgramInfoLog(a));t.useProgram(a);return a};var a=function e(t,r){var n=t.createBuffer(),i=r?t.ELEMENT_ARRAY_BUFFER:t.ARRAY_BUFFER;t.bindBuffer(i,n);return n};var c=function e(t,r,n,i){var o=i?t.ELEMENT_ARRAY_BUFFER:t.ARRAY_BUFFER;t.bufferData(o,r,n)};var v=function e(t,r,n,i,o,a,f){t.vertexAttribPointer(r,n,i,f||false,o||0,a||0);t.enableVertexAttribArray(r)};var s=function e(t,r,n,i){var o=t.createTexture();if(i=="2d"){n=n||0;t.activeTexture(t["TEXTURE"+n])}t.bindTexture(r,o);return o};var h=function e(t,r,n,i,o,a){i={rgb:t.RGB,rgba:t.RGBA,alpha:t.ALPHA}[i]||t.RGBA;t.texImage2D(r,n||0,i,i,{}[o]||t.UNSIGNED_BYTE,a)};var d=function e(t,r,n,i,o,a,f,u,s){i={rgb:t.RGB,rgba:t.RGBA,alpha:t.ALPHA}[i]||t.RGBA;n=n||0;o={}[o]||t.UNSIGNED_BYTE;var l=[t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_Z],c=void 0,v=void 0;for(c=0;c<l.length;c++){v=l[c];t.texImage2D(v,n,i,f,u,0,i,o,null);t.bindTexture(r,s);t.texImage2D(v,n,i,i,o,a[c])}t.generateMipmap(r)};function u(f){return{setAttribute1f:function e(t,r){var n=f.getAttribLocation(f.program,t);f.vertexAttrib1f(n,r)},setAttribute2f:function e(t,r,n){var i=f.getAttribLocation(f.program,t);f.vertexAttrib2f(i,r,n)},setAttribute3f:function e(t,r,n,i){var o=f.getAttribLocation(f.program,t);f.vertexAttrib3f(o,r,n,i)},setAttribute4f:function e(t,r,n,i,o){var a=f.getAttribLocation(f.program,t);f.vertexAttrib4f(a,r,n,i,o)},setAttribute1i:function e(t,r){var n=f.getAttribLocation(f.program,t);f.vertexAttrib1i(n,r)},setAttribute2i:function e(t,r,n){var i=f.getAttribLocation(f.program,t);f.vertexAttrib2i(i,r,n)},setAttribute3i:function e(t,r,n,i){var o=f.getAttribLocation(f.program,t);f.vertexAttrib3i(o,r,n,i)},setAttribute4i:function e(t,r,n,i,o){var a=f.getAttribLocation(f.program,t);f.vertexAttrib4i(a,r,n,i,o)},setUniform1f:function e(t,r){var n=f.getUniformLocation(f.program,t);f.uniform1f(n,r)},setUniform2f:function e(t,r,n){var i=f.getUniformLocation(f.program,t);f.uniform2f(i,r,n)},setUniform3f:function e(t,r,n,i){var o=f.getUniformLocation(f.program,t);f.uniform3f(o,r,n,i)},setUniform4f:function e(t,r,n,i,o){var a=f.getUniformLocation(f.program,t);f.uniform4f(a,r,n,i,o)},setUniform1i:function e(t,r){var n=f.getUniformLocation(f.program,t);f.uniform1i(n,r)},setUniform2i:function e(t,r,n){var i=f.getUniformLocation(f.program,t);f.uniform2i(i,r,n)},setUniform3i:function e(t,r,n,i){var o=f.getUniformLocation(f.program,t);f.uniform3i(o,r,n,i)},setUniform4i:function e(t,r,n,i,o){var a=f.getUniformLocation(f.program,t);f.uniform4i(a,r,n,i,o)},setUniformMatrix2fv:function e(t,r){var n=f.getUniformLocation(f.program,t);f.uniformMatrix2fv(n,false,r)},setUniformMatrix3fv:function e(t,r){var n=f.getUniformLocation(f.program,t);f.uniformMatrix3fv(n,false,r)},setUniformMatrix4fv:function e(t,r){var n=f.getUniformLocation(f.program,t);f.uniformMatrix4fv(n,false,r)}}}function p(i){var o={byte:i.UNSIGNED_BYTE,short:i.UNSIGNED_SHORT};return{openDeep:function e(){i.enable(i.DEPTH_TEST);return this},points:function e(t,r,n){if(n){i.drawElements(i.POINTS,r,o[n],t)}else{i.drawArrays(i.POINTS,t,r)}return this},lines:function e(t,r,n){if(n){i.drawElements(i.LINES,r,o[n],t)}else{i.drawArrays(i.LINES,t,r)}return this},stripLines:function e(t,r,n){if(n){i.drawElements(i.LINE_STRIP,r,o[n],t)}else{i.drawArrays(i.LINE_STRIP,t,r)}return this},loopLines:function e(t,r,n){if(n){i.drawElements(i.LINE_LOOP,r,o[n],t)}else{i.drawArrays(i.LINE_LOOP,t,r)}return this},triangles:function e(t,r,n){if(n){i.drawElements(i.TRIANGLES,r,o[n],t)}else{i.drawArrays(i.TRIANGLES,t,r)}return this},stripTriangles:function e(t,r,n){if(n){i.drawElements(i.TRIANGLE_STRIP,r,o[n],t)}else{i.drawArrays(i.TRIANGLE_STRIP,t,r)}return this},fanTriangles:function e(t,r,n){if(n){i.drawElements(i.TRIANGLE_FAN,r,o[n],t)}else{i.drawArrays(i.TRIANGLE_FAN,t,r)}return this}}}var m=function e(t,r){var n=["webgl","experimental-webgl","webkit-3d","moz-webgl"],i=null,o=void 0;for(o=0;o<n.length;o++){try{i=t.getContext(n[o],r)}catch(e){}if(i)break}if(!i)throw new Error("Non canvas or browser does not support webgl.");return i};function l(e,t){var l=m(e,t),n={_gl_:l,painter:function e(){return p(l)},shader:function e(t,r){l.program=o(l,t,r);return n},buffer:function e(n){a(l,n);var u=void 0,s={write:function e(t,r){r=r||l.STATIC_DRAW;c(l,t,r,n);u=t;return s},use:function e(t,r,n,i,o,a){var f=u.BYTES_PER_ELEMENT;if(typeof t=="string")t=l.getAttribLocation(l.program,t);n=n||0;i=i||0;o=o||l.FLOAT;v(l,t,r,o,n*f,i*f,a);return s}};return s},texture:function f(e,t){var u={"2d":l.TEXTURE_2D,cube:l.TEXTURE_CUBE_MAP}[e];var f=s(l,u,t,e);l.texParameteri(u,l.TEXTURE_MIN_FILTER,l.NEAREST);l.texParameteri(u,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE);l.texParameteri(u,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE);var o={useImage:function e(t,r,n,i){h(l,u,r,n,i,t);return o},useCube:function e(t,r,n,i,o,a){d(l,u,i,o,a,t,r,n,f)}};return o}};var r=u(l);for(var i in r){n[i]=r[i]}l.viewport(0,0,l.canvas.width,l.canvas.height);l.depthFunc(l.LEQUAL);return n}function g(e,t){for(var r in t){try{e[r]=t[r]}catch(e){throw new Error("Illegal property key : "+r)}}return e}function y(r,e){return function(t){return new function e(){var i=this;var o=r.buffer(t);this.write=function(e){o.write(e);return i};if(!t){this.use=function(e,t,r,n){o.use(e,t,r,n);return i}}}}}function b(e,t,r,n){n=n||0;var i=Math.sqrt(t*t+r*r+n*n);return[1,0,0,0,0,1,0,0,0,0,1,0,t*e/i,r*e/i,n*e/i,1]}function w(e){var t=Math.sin(e),r=Math.cos(e);return[r,t,0,0,-t,r,0,0,0,0,1,0,0,0,0,1]}function E(e,t,r,n,i,o){n=n||0;i=i||0;o=o||0;return[e,0,0,0,0,t,0,0,0,0,r,0,n-n*e,i-i*t,o-o*r,1]}function x(e,t,r,n,i,o){if(typeof e==="number"&&typeof t==="number"){if(typeof r!=="number"){r=0;n=e;i=t;o=1}else if(typeof n!=="number"||typeof i!=="number"||typeof o!=="number"){n=e;i=t;o=r;e=0;t=0;r=0}if(e==n&&t==i&&r==o)throw new Error("It's not a legitimate ray!");var a=Math.sqrt((n-e)*(n-e)+(i-t)*(i-t)),f=a!=0?(i-t)/a:1,u=a!=0?(n-e)/a:0,s=(n-e)*u+(i-t)*f,l=o-r,c=Math.sqrt(s*s+l*l),v=c!=0?l/c:1,h=c!=0?s/c:0;return[[f,v*u,u*h,0,-u,f*v,f*h,0,0,-h,v,0,t*u-e*f,r*h-e*u*v-t*f*v,-e*u*h-t*f*h-r*v,1],[f,-u,0,0,v*u,v*f,-h,0,u*h,f*h,v,0,e,t,r,1]]}else{throw new Error("a1 and b1 is required!")}}var A=function e(t,r){var n=[];for(var i=0;i<4;i++){for(var o=0;o<r.length/4;o++){n[o*4+i]=t[i]*r[o*4]+t[i+4]*r[o*4+1]+t[i+8]*r[o*4+2]+t[i+12]*r[o*4+3]}}return n};function _(e){var s=e||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var l={move:function e(t,r,n,i){s=A(b(t,r,n,i),s);return l},rotate:function e(t,r,n,i,o,a,f){var u=x(r,n,i,o,a,f);s=A(A(A(u[1],w(t)),u[0]),s);return l},scale:function e(t,r,n,i,o,a){s=A(E(t,r,n,i,o,a),s);return l},multiply:function e(t,r){s=r?A(s,t):A(t,s);return l},use:function e(t,r,n,i){n=n||0;i=i||1;var o=A(s,[t,r,n,i]);o[0]=+o[0].toFixed(7);o[1]=+o[1].toFixed(7);o[2]=+o[2].toFixed(7);o[3]=+o[3].toFixed(7);return o},value:function e(){return s}};return l}var T=function e(t){return Array.isArray(t)};function S(i,e){return function(){var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new function e(){var f=this;var n=i._gl_.canvas.clientWidth/i._gl_.canvas.clientHeight;if(T(r.size)){r.size=r.size[0];console.warn('"options.size" should be a number. The writing of array is out of date: https://hai2007.gitee.io/image3d/index.html#/api?fixed=camera-set')}var u=_();var t=r.proof?-1:1;u.multiply([1/r.size,0,0,0,0,1/r.size,0,0,0,0,t/r.size,0,0,0,0,1]);this.setProportion=function(e){n=e;return f};this.rotateEye=function(e,t,r,n,i,o,a){u.rotate(-e,t,r,n,i,o,a);return f};this.moveEye=function(e,t,r,n){u.move(-e,t,r,n);return f};this.rotateBody=function(e,t,r,n,i,o,a){u.rotate(e,t,r,n,i,o,a);return f};this.moveBody=function(e,t,r,n){u.move(e,t,r,n);return f};this.scaleBody=function(e,t,r,n,i,o){u.scale(e,t,r,n,i,o);return f};this.value=function(){var e=1;var t=1;if(n>1){t=n}else{e=1/n}var r=Math.max(e,t);return _(u.value()).multiply([e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1]).value()}}}}function n(r,n){n.drawPoint=function(e,t){r.points(e,t);return n};n.drawLine=function(e,t){r.lines(e,t);return n};n.drawStripLine=function(e,t){r.stripLines(e,t);return n};n.drawLoopLine=function(e,t){r.loopLines(e,t);return n};n.drawTriangle=function(e,t){r.triangles(e,t);return n};n.drawStripTriangle=function(e,t){r.stripTriangles(e,t);return n};n.drawFanTriangle=function(e,t){r.fanTriangles(e,t);return n}}function i(n,i){i.elemPoint=function(e,t,r){r=r||"byte";n.points(e,t,r);return i};i.elemLine=function(e,t,r){r=r||"byte";n.lines(e,t,r);return i};i.elemStripLine=function(e,t,r){r=r||"byte";n.stripLines(e,t,r);return i};i.elemLoopLine=function(e,t,r){r=r||"byte";n.loopLines(e,t,r);return i};i.elemTriangle=function(e,t,r){r=r||"byte";n.triangles(e,t,r);return i};i.elemStripTriangle=function(e,t,r){r=r||"byte";n.stripTriangles(e,t,r);return i};i.elemFanTriangle=function(e,t,r){r=r||"byte";n.fanTriangles(e,t,r);return i}}function L(e,t){var r=e.painter();if(t.depth){r.openDeep()}return function(){return new function e(){n(r,this);i(r,this)}}}function N(i,e){return function(n){return new function e(){var t=this;var r=i.texture("2d",n);this.write=function(e){r.useImage(e);return t}}}}function P(t,e){return function(u,s){return new function e(){var a=this;var f=t.texture("cube");this.write=function(e,t,r,n,i,o){f.useCube([e,t,r,n,i,o],u,s);return a}}}}var t={vs:"\n    attribute vec4 a_position;\n    attribute vec4 a_color;\n    attribute float a_size;\n    varying vec4 v_color;\n    void main(){\n        gl_Position=a_position;\n        gl_PointSize=a_size;\n        v_color=a_color;\n    }\n    ",fs:"\n    precision mediump float;\n    varying vec4 v_color;\n    void main(){\n        gl_FragColor=v_color;\n    }\n    "};var r={vs:"\n    attribute vec4 a_position;\n    attribute vec4 a_color;\n    attribute float a_size;\n    varying vec4 v_color;\n    uniform mat4 u_matrix;\n    void main(){\n        gl_Position=u_matrix * a_position;\n        gl_PointSize=a_size;\n        v_color=a_color;\n    }\n    ",fs:"\n    precision mediump float;\n    varying vec4 v_color;\n    void main(){\n        gl_FragColor=v_color;\n    }\n    "};function U(e){return{type_default:t,type_camera:r}["type_"+e]}var e=function e(t,r){var n=g({depth:false},r||{});var o=l(t);var i=n["vertex-shader"],a=n["fragment-shader"];if(!i||!a){var f=U(n.shader||"default");i=f.vs;a=f.fs}o.shader(i,a);e.fn=e.prototype;e.fn.Buffer=y(o);e.fn.Camera=S(o);e.fn.Painter=L(o,n);e.fn.Texture2D=N(o);e.fn.TextureCube=P(o);e.fn.setAttributeFloat=function(e,t,r,n,i){o["setAttribute"+(arguments.length-1)+"f"](e,t,r,n,i);return this};e.fn.setAttributeInt=function(e,t,r,n,i){o["setAttribute"+(arguments.length-1)+"i"](e,t,r,n,i);return this};e.fn.setUniformFloat=function(e,t,r,n,i){o["setUniform"+(arguments.length-1)+"f"](e,t,r,n,i);return this};e.fn.setUniformInt=function(e,t,r,n,i){o["setUniform"+(arguments.length-1)+"i"](e,t,r,n,i);return this};e.fn.setUniformMatrix=function(e,t){var r={4:2,9:3,16:4}[t.length];o["setUniformMatrix"+r+"fv"](e,t);return this}};e.core=l;if(M(I)==="object"&&M(I.exports)==="object"){I.exports=e}else{var R=window.image3D;e.noConflict=function(){if(window.image3D===e){window.image3D=R}return e};window.image3D=e}})()});var Y={48:[0,")"],49:[1,"!"],50:[2,"@"],51:[3,"#"],52:[4,"$"],53:[5,"%"],54:[6,"^"],55:[7,"&"],56:[8,"*"],57:[9,"("],96:[0,0],97:1,98:2,99:3,100:4,101:5,102:6,103:7,104:8,105:9,106:"*",107:"+",109:"-",110:".",111:"/",65:["a","A"],66:["b","B"],67:["c","C"],68:["d","D"],69:["e","E"],70:["f","F"],71:["g","G"],72:["h","H"],73:["i","I"],74:["j","J"],75:["k","K"],76:["l","L"],77:["m","M"],78:["n","N"],79:["o","O"],80:["p","P"],81:["q","Q"],82:["r","R"],83:["s","S"],84:["t","T"],85:["u","U"],86:["v","V"],87:["w","W"],88:["x","X"],89:["y","Y"],90:["z","Z"],37:"left",38:"up",39:"right",40:"down",33:"page up",34:"page down",35:"end",36:"home",16:"shift",17:"ctrl",18:"alt",91:"command",92:"command",93:"command",224:"command",9:"tab",20:"caps lock",32:"spacebar",8:"backspace",13:"enter",27:"esc",46:"delete",45:"insert",144:"number lock",145:"scroll lock",12:"clear",19:"pause",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",189:["-","_"],187:["=","+"],219:["[","{"],221:["]","}"],220:["\\","|"],186:[";",":"],222:["'",'"'],188:[",","<"],190:[".",">"],191:["/","?"],192:["`","~"]};var W=["shift","ctrl","alt"];function $(e){e=e||window.event;var t=e.keyCode||e.which;var r=Y[t]||t;if(!r)return;if(r.constructor!==Array)r=[r,r];var n=r[0];var i=e.shiftKey?"shift+":"",o=e.altKey?"alt+":"",a=e.ctrlKey?"ctrl+":"";var f="",u=a+i+o;if(W.indexOf(r[0])>=0){r[0]=r[1]=""}var s=e.code=="Key"+e.key&&!i;f=u+(u==""&&s?r[1]:r[0]);if(r[0]==""){f=f.replace(/\+$/,"")}return f==""?n:f}function K(i){var o=document.getElementsByTagName("body")[0];h.bind(o,"keydown",function(e){var t=$(e);if(t=="up"){i({type:"lookUp"})}else if(t=="down"){i({type:"lookDown"})}else if(t=="left"){i({type:"lookLeft"})}else if(t=="right"){i({type:"lookRight"})}});var a=null;var t=function(e){if(a==null)return;var t=h.mousePosition(o,e);var r=[t.x-a.x,a.y-t.y];var n=[r[1],r[0]*-1,0];if(n[0]==0&&n[1]==0)return;i({type:"rotate",normal:n,dist:Math.abs(t.x-a.x)+Math.abs(t.y-a.y)});a=t};h.bind(o,"mousedown",function(e){a=h.mousePosition(o,e)});h.bind(o,"mouseup",function(e){a=null});h.bind(o,"mousemove",function(e){t(e)});h.bind(o,"touchend",function(e){a=null});h.bind(o,"touchstart",function(e){a=h.mousePosition(o,e.touches[0])});h.bind(o,"touchmove",function(e){t(e.touches[0])});let r=function(e){if(e==0)return;i({type:"scale",kind:e<0?"reduce":"enlarge",rate:Math.abs(e)})};h.bind(o,"mousewheel",function(e){r(e.wheelDelta)});if(window.addEventListener){window.addEventListener("DOMMouseScroll",function(e){r(-1*e.detail)},false)}}var q="\n    attribute vec4 a_position;\n    uniform mat4 u_matrix;\n    void main(){\n\n        vec4 temp = u_matrix * a_position;\n\n        // 表示眼睛距离vec4(0.0,0.0,1.0)的距离\n        float dist = 2.0;\n\n        // 使用投影直接计算\n        // 此处要注意z轴承显示和实际的方向是相反的\n        gl_Position = vec4((dist + 1.0) * temp.x / (dist + temp.z), (dist + 1.0) * temp.y / (dist + temp.z), temp.z, 1.0);\n\n    }\n";var Z="\n    precision mediump float;\n    uniform vec4 u_color;\n    void main(){\n        gl_FragColor=u_color;\n    }\n";var Q=function(){function v(e){var i=this;r(this,v);f(this,"size",void 0);f(this,"canvas",void 0);f(this,"image3d",void 0);f(this,"painter",void 0);f(this,"buffer",void 0);f(this,"camera",void 0);f(this,"doDraw",null);f(this,"option",{});this.size=h.size(e);this.canvas=h.append(e,"<canvas width='"+this.size.width+"' height='"+this.size.height+"'>非常抱歉，您的浏览器不支持canvas!</canvas>");this.image3d=new H(this.canvas,{"vertex-shader":q,"fragment-shader":Z,depth:true});this.painter=this.image3d.Painter();this.buffer=this.image3d.Buffer();this.camera=this.image3d.Camera({size:2}).rotateBody(.1,-1,0,0,1,0,0);p(e,function(){});var o=.1;var a=1;K(function(e){if(i.doDraw==null)return;if(e.type=="lookUp"){i.camera.rotateBody(o,1,0,0)}else if(e.type=="lookDown"){i.camera.rotateBody(o,-1,0,0)}else if(e.type=="lookLeft"){i.camera.rotateBody(o,0,1,0)}else if(e.type=="lookRight"){i.camera.rotateBody(o,0,-1,0)}else if(e.type=="rotate"){var t;(t=i.camera).rotateBody.apply(t,[o*e.dist*.07].concat(u(e.normal)))}else if(e.type=="scale"){if(e.kind=="enlarge"&&a>=1.28){return}var r=.899;var n=e.kind=="enlarge"?2-r:r;a*=n;i.camera.scaleBody(n,n,n,0,0,0)}i.doDraw()})}e(v,[{key:"setOption",value:function e(t){var i=this;this.option=j(this.option,t);var r=[];if("series"in this.option){var n=d(this.option.series),o;try{for(n.s();!(o=n.n()).done;){var a=o.value;var f=v.charts[a.type]({data:a.data||this.option.data||[]},{color:function e(t){return v.theme.colors[t%v.theme.colors.length]}});var u=d(f.geometry),s;try{for(u.s();!(s=u.n()).done;){var l=s.value;r.push(l)}}catch(e){u.e(e)}finally{u.f()}}}catch(e){n.e(e)}finally{n.f()}}var c=V(r,this.option);this.doDraw=function(){i.image3d.setUniformMatrix("u_matrix",i.camera.value());var t=d(c.geometry),e;try{for(t.s();!(e=t.n()).done;){var r=e.value;var n=r.data;i.buffer.write(new Float32Array(n.points)).use("a_position",3,3,0);i.image3d.setUniformFloat("u_color",r.color[0],r.color[1],r.color[2],r.color[3]);i.painter["draw"+n.methods](0,n.length)}}catch(e){t.e(e)}finally{t.f()}};this.doDraw()}}],[{key:"registerTheme",value:function e(t){v.theme=b(t)}},{key:"registerChart",value:function e(t,r){if(t in v.charts){throw new Error("This chart is already defined:"+t)}v.charts[t]=r}}]);return v}();f(Q,"charts",{});f(Q,"theme",void 0);if((typeof module==="undefined"?"undefined":t(module))==="object"&&t(module.exports)==="object"){module.exports=Q}else{window["Puly"]=Q}})();