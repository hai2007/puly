/*!
 * puly - 基于Image3D.js开发，底层依赖webgl实现，通过配置和简单的方法调用，可以快速实现三维数据可视化和VR效果等。
 * git+https://github.com/hai2007/puly.git
 *
 * author 你好2007 < https://hai2007.gitee.io/sweethome >
 *
 * version 1.0.0-alpha.3
 *
 * Copyright (c) 2021-2022 hai2007 走一步，再走一步。
 * Released under the MIT license
 *
 * Date:Mon May 02 2022 01:55:29 GMT+0800 (GMT+08:00)
 */
(function(){"use strict";function t(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){t=function(e){return typeof e}}else{t=function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return t(e)}function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}function e(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);return e}function i(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function l(e,t){if(!e)return;if(typeof e==="string")return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(e,t)}function o(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function c(e,t){var r=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=l(e))||t&&e&&typeof e.length==="number"){if(r)e=r;var n=0;var i=function(){};return{s:i,n:function(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,s=false,f;return{s:function(){r=r.call(e)},n:function(){var e=r.next();o=e.done;return e},e:function(e){s=true;f=e},f:function(){try{if(!o&&r.return!=null)r.return()}finally{if(s)throw f}}}}var s={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};var f={stopPropagation:function(e){e=e||window.event;if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}},preventDefault:function(e){e=e||window.event;if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},isNode:function(e){return e&&(e.nodeType===1||e.nodeType===9||e.nodeType===11)},bind:function(e,t,r){if(e.constructor===Array||e.constructor===NodeList||e.constructor===HTMLCollection){for(var n=0;n<e.length;n++){this.bind(e[n],t,r)}return}if(window.attachEvent)e.attachEvent("on"+t,r);else e.addEventListener(t,r,false)},unbind:function(e,t,r){if(e.constructor===Array||e.constructor===NodeList||e.constructor===HTMLCollection){for(var n=0;n<e.length;n++){this.unbind(e[n],t,r)}return}if(window.detachEvent)e.detachEvent("on"+t,r);else e.removeEventListener(t,r,false)},find:function(e,t,r){if(!this.isNode(e))return[];var n=e.getElementsByTagName(r||"*");var i=[];for(var o=0;o<n.length;o++){if(this.isNode(n[o])&&(typeof t!="function"||t(n[o])))i.push(n[o])}return i},children:function(e,t){var r=e.childNodes;var n=[];for(var i=0;i<r.length;i++){if(this.isNode(r[i])&&(typeof t!="function"||t(r[i])))n.push(r[i])}return n},hasClass:function(e,t,r){if(t.constructor!==Array)t=[t];var n=" "+(e.getAttribute("class")||"")+" ";for(var i=0;i<t.length;i++){if(n.indexOf(" "+t[i]+" ")>=0){if(r)return true}else{if(!r)return false}}return true},removeClass:function(e,t){var r=" "+(e.getAttribute("class")||"")+" ";var n=r.replace(" "+t.trim()+" "," ");e.setAttribute("class",n.trim())},addClass:function(e,t){if(this.hasClass(e,t))return;var r=e.getAttribute("class")||"";e.setAttribute("class",r+" "+t)},toNode:function(e,t){var r;if(t)r=document.createElementNS(s.svg,"svg");else{var n="div";if(/^<tr[> ]/.test(e)){n="tbody"}else if(/^<th[> ]/.test(e)||/^<td[> ]/.test(e)){n="tr"}else if(/^<thead[> ]/.test(e)||/^<tbody[> ]/.test(e)){n="table"}r=document.createElement(n)}r.innerHTML=e;var i=r.childNodes;for(var o=0;o<i.length;o++){if(this.isNode(i[o]))return i[o]}},trigger:function(e,t){if(document.createEventObject){e.fireEvent("on"+t,document.createEventObject())}else{var r=document.createEvent("HTMLEvents");r.initEvent(t,true,false);e.dispatchEvent(r)}},getStyle:function(e,t){var r=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null):e.currentStyle;return typeof t==="string"?r.getPropertyValue(t):r},offsetPosition:function(e){var t=0;var r=0;r=e.offsetTop;t=e.offsetLeft;e=e.offsetParent;while(e){r+=e.offsetTop;t+=e.offsetLeft;e=e.offsetParent}return{left:t,top:r}},mousePosition:function(e,t){var r=e.getBoundingClientRect();if(!t||!t.clientX)throw new Error("Event is necessary!");return{x:t.clientX-r.left,y:t.clientY-r.top}},remove:function(e){e.parentNode.removeChild(e)},setStyles:function(e,t){for(var r in t)e.style[r]=t[r]},size:function(e,t){var r,n;if(t=="content"){n=e.clientWidth-(this.getStyle(e,"padding-left")+"").replace("px","")-(this.getStyle(e,"padding-right")+"").replace("px","");r=e.clientHeight-(this.getStyle(e,"padding-top")+"").replace("px","")-(this.getStyle(e,"padding-bottom")+"").replace("px","")}else if(t=="padding"){n=e.clientWidth;r=e.clientHeight}else if(t=="border"){n=e.offsetWidth;r=e.offsetHeight}else if(t=="scroll"){n=e.scrollWidth;r=e.scrollHeight}else{n=e.offsetWidth;r=e.offsetHeight}return{width:n,height:r}},append:function(e,t){var r=this.isNode(t)?t:this.toNode(t);e.appendChild(r);return r},prepend:function(e,t){var r=this.isNode(t)?t:this.toNode(t);e.insertBefore(r,e.childNodes[0]);return r},after:function(e,t){var r=this.isNode(t)?t:this.toNode(t);e.parentNode.insertBefore(r,e.nextSibling);return r},before:function(e,t){var r=this.isNode(t)?t:this.toNode(t);e.parentNode.insertBefore(r,e);return r}};var a=true;function h(e,r){var t=null;var n=false;var i=false;var o=function e(){if(!n){n=true;var t=window.setInterval(function(){if(!i){window.clearInterval(t);n=false;r()}i=false},100)}else{i=true}};try{t=new ResizeObserver(o);t.observe(e)}catch(e){if(a){console.error("ResizeObserver undefined!");a=false}o();window.addEventListener("resize",o,false)}return function(){if(t){t.disconnect()}}}var u={whitespace:"[\\x20\\t\\r\\n\\f]"};function d(e,t){var r=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null):e.currentStyle;return typeof t==="string"?r.getPropertyValue(t):r}function v(e){var t=document.getElementsByTagName("head")[0];t.style["color"]=e;var r=d(t,"color");var n=r.replace(/^rgba?\(([^)]+)\)$/,"$1").split(new RegExp("\\,"+u.whitespace));return[+n[0],+n[1],+n[2],n[3]==undefined?1:+n[3]]}var p=function(e){var t={colors:[]};if("colors"in e){var r=c(e.colors),n;try{for(r.s();!(n=r.n()).done;){var i=n.value;var o=v(i);t.colors.push([o[0]/255,o[1]/255,o[2]/255,o[3]])}}catch(e){r.e(e)}finally{r.f()}}return t};function g(e){var t=typeof e;return e!=null&&(t==="object"||t==="function")}var y=Object.prototype.toString;function w(e){if(e==null){return e===undefined?"[object Undefined]":"[object Null]"}return y.call(e)}function b(e){var t=typeof e;return t==="string"||t==="object"&&e!=null&&!Array.isArray(e)&&w(e)==="[object String]"}var m=g;var x=b;var E=function(e){return Array.isArray(e)};var S={blankReg:new RegExp("[\\x20\\t\\r\\n\\f]"),blanksReg:/^[\x20\t\r\n\f]{0,}$/,identifier:/^[a-zA-Z_$][0-9a-zA-Z_$]{0,}$/};var N=["+","-","*","/","%","&","|","!","?",":","[","]","(",")",">","<","="];var O=["+","-","*","/","%","&","|","!","?",":",">","<","=","<=",">=","==","===","!=","!=="];function A(e,t,r){t=t.trim();var n=-1,i=null;var o=function(){i=n++<t.length-1?t[n]:null;return i};var s=function(e){return t.substring(n,e+n>t.length?t.length:e+n)};o();var f=[];while(true){if(n>=t.length)break;if(N.indexOf(i)>-1){if(["&","|","="].indexOf(i)>-1){if(["==="].indexOf(s(3))>-1){f.push(s(3));n+=2;o()}else if(["&&","||","=="].indexOf(s(2))>-1){f.push(s(2));n+=1;o()}else{throw new Error("Illegal expression : "+t+"\nstep='analyseExpress',index="+n)}}else{if(["!=="].indexOf(s(3))>-1){f.push(s(3));n+=2;o()}else if([">=","<=","!="].indexOf(s(2))>-1){f.push(s(2));n+=1;o()}else{f.push(i);o()}}}else if(['"',"'"].indexOf(i)>-1){var l="",a=i;o();while(i!=a){if(n>=t.length){throw new Error("String unclosed error : "+t+"\nstep='analyseExpress',index="+n)}l+=i;o()}f.push(l+"@string");o()}else if(/\d/.test(i)){var u="no";var l=i;o();while(n<t.length){if(/\d/.test(i)){l+=i;if(u=="error")u="yes"}else if("."==i&&u=="no"){l+=i;u="error"}else{break}o()}if(u=="error")l+="0";f.push(+l)}else if(["null","true"].indexOf(s(4))>-1){f.push({null:null,true:true}[s(4)]);n+=3;o()}else if(["false"].indexOf(s(5))>-1){f.push({false:false}[s(5)]);n+=4;o()}else if(["undefined"].indexOf(s(9))>-1){f.push({undefined:undefined}[s(9)]);n+=8;o()}else if(S.blankReg.test(i)){do{o()}while(S.blankReg.test(i)&&n<t.length)}else{var c=false;if(i=="."){c=true;o()}if(S.identifier.test(i)){var h=1;while(n+h<=t.length&&S.identifier.test(s(h)))h+=1;if(c){f.push("[");f.push(s(h-1)+"@string");f.push("]")}else{var d=s(h-1);var v=d in r?r[d]:e[d];f.push(x(v)?v+"@string":v)}n+=h-2;o()}else{throw new Error("Illegal express : "+t+"\nstep='analyseExpress',index="+n)}}}var p=0;for(var g=0;g<f.length;g++){if(["+","-"].indexOf(f[g])>-1&&(g==0||O.indexOf(f[p-1])>-1)){f[p++]=+(f[g]+f[g+1]);g+=1}else{f[p++]=f[g]}}f.length=p;return f}var z=function(e){if(typeof e=="string")return e.replace(/@string$/,"");return e};var C=function(e){if(typeof e=="string")return e+"@string";return e};function j(e){var t=0,r=0;for(;r<e.length;r++){if(e[r]=="!"){e[t]=!e[++r]}else e[t]=e[r];t+=1}if(t==1)return z(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="*"){e[t-1]=z(e[t-1])*z(e[++r])}else if(e[r]=="/"){e[t-1]=z(e[t-1])/z(e[++r])}else if(e[r]=="%"){e[t-1]=z(e[t-1])%z(e[++r])}else{e[t++]=e[r]}}if(t==1)return z(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="+"){e[t-1]=C(z(e[t-1])+z(e[++r]))}else if(e[r]=="-"){e[t-1]=z(e[t-1])-z(e[++r])}else e[t++]=e[r]}if(t==1)return z(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]==">"){e[t-1]=z(e[t-1])>z(e[++r])}else if(e[r]=="<"){e[t-1]=z(e[t-1])<z(e[++r])}else if(e[r]=="<="){e[t-1]=z(e[t-1])<=z(e[++r])}else if(e[r]==">="){e[t-1]=z(e[t-1])>=z(e[++r])}else e[t++]=e[r]}if(t==1)return z(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="=="){e[t-1]=z(e[t-1])==z(e[++r])}else if(e[r]=="==="){e[t-1]=z(e[t-1])===z(e[++r])}else if(e[r]=="!="){e[t-1]=z(e[t-1])!=z(e[++r])}else if(e[r]=="!=="){e[t-1]=z(e[t-1])!==z(e[++r])}else e[t++]=e[r]}if(t==1)return z(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="&&"){e[t-1]=z(e[t-1])&&z(e[1+r]);r+=1}else if(e[r]=="||"){e[t-1]=z(e[t-1])||z(e[1+r]);r+=1}else e[t++]=e[r]}if(t==1)return z(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="?"){e[t-1]=z(e[t-1])?z(e[r+1]):z(e[r+3]);r+=3}else e[t++]=e[r]}if(t==1)return z(e[0]);e.length=t;throw new Error("Unrecognized expression : ["+e.toString()+"]")}function T(t,r,n){var e=r[0]in n?n[r[0]]:t[r[0]];for(var i=1;i<r.length;i++){try{e=e[r[i]]}catch(e){console.error({target:t,scope:n,expressArray:r,index:i});throw e}}return e}var k=function(e,t,r){if(t.indexOf("(")>-1){var n=[],i=[],o=0;for(var s=0;s<t.length;s++){if(t[s]=="("){if(o>0){i.push("(")}o+=1}else if(t[s]==")"){if(o>1)i.push(")");o-=1;if(o==0){var f=j(k(e,i));n.push(x(f)?f+"@string":f);i=[]}}else{if(o>0)i.push(t[s]);else n.push(t[s])}}t=n}return L(t)};var L=function(e){var t=true;while(t){t=false;var r=[],n=[],i=false;for(var o=0;o<e.length;o++){if(e[o]=="["&&o!=0&&e[o-1]!="]"){if(i){r.push("[");for(var s=0;s<n.length;s++)r.push(n[s])}else{i=true}n=[]}else if(e[o]=="]"&&i){t=true;var f=j(n);var l=r[r.length-1][f];r[r.length-1]=x(l)?l+"@string":l;i=false}else{if(i){n.push(e[o])}else{r.push(e[o])}}}e=r}return e};var P=function(e){var t=[],r=[];for(var n=0;n<e.length;n++){if(e[n]=="["){r=[]}else if(e[n]=="]"){t.push(j(r))}else{r.push(e[n])}}return t};function H(e,t,r){var n=k(e,t);var i;if(n[0]!="["){i=[j(n)]}else if(n[n.length-1]=="]"){i=P(n)}else{var o=n.lastIndexOf("]");var s=P(n.slice(0,o+1));var f=n.slice(o+1);f.unshift(T(e,s,r));i=[j(f)]}return i}var R=function(e,t,r){if(arguments.length<3)r={};var n=A(e,t,r);var i=H(e,n,r);return T(e,i,r)};var V=function(e,t,r,n){if(arguments.length<4)n={};var i=A(e,t,n);var o=H(e,i,n);var s=e;for(var f=0;f<o.length-1;f++){if(!(o[f]in s))s[o[f]]=E(s)?[]:{};s=s[o[f]]}s[o[o.length-1]]=r;return e};function I(o,e){(function e(t,r){for(var n in r){var i=t+"['"+n+"']";if(m(r[n])&&!E(r[n])){if(!R(o,i)){V(o,i,{})}e(i,r[n])}else{V(o,i,r[n])}}})("",e);return o}var $=function(e,t){console.log(e,t)};var B=function(){function u(e){var t=this;r(this,u);i(this,"size",void 0);i(this,"canvas",void 0);i(this,"option",{});this.size=f.size(e);this.canvas=f.append(e,"<canvas width='"+this.size.width+"' height='"+this.size.height+"'>非常抱歉，您的浏览器不支持canvas!</canvas>");h(e,function(){t.size=f.size(e);t.canvas.setAttribute("width",""+t.size.width);t.canvas.setAttribute("height",""+t.size.height)})}e(u,[{key:"setOption",value:function e(t){this.option=I(this.option,t);var r=[];if("series"in this.option){var n=c(this.option.series),i;try{for(n.s();!(i=n.n()).done;){var o=i.value;var s=u.charts[o.type]({data:o.data},{color:function e(t){return u.theme.colors[t%u.theme.colors.length]}});var f=c(s.geometry),l;try{for(f.s();!(l=f.n()).done;){var a=l.value;r.push(a)}}catch(e){f.e(e)}finally{f.f()}}}catch(e){n.e(e)}finally{n.f()}}console.log($(r,this.option))}}],[{key:"registerTheme",value:function e(t){u.theme=p(t)}},{key:"registerChart",value:function e(t,r){if(t in u.charts){throw new Error("This chart is already defined:"+t)}u.charts[t]=r}}]);return u}();i(B,"charts",{});i(B,"theme",void 0);if((typeof module==="undefined"?"undefined":t(module))==="object"&&t(module.exports)==="object"){module.exports=B}else{window["Puly"]=B}})();