/*!
 * puly - 一个简单易用的3D图表，像ECharts一样可以快速上手，配置化生成，并支持个性化自定义扩展。
 * git+https://github.com/hai2007/puly.git
 *
 * author 你好2007 < https://hai2007.gitee.io/sweethome >
 *
 * version 1.2.5-alpha.0
 *
 * Copyright (c) 2021-2022 hai2007 走一步，再走一步。
 * Released under the MIT license
 *
 * Date:Sun May 08 2022 15:53:48 GMT+0800 (GMT+08:00)
 */
(function(){"use strict";function t(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){t=function(e){return typeof e}}else{t=function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return t(e)}function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}function e(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);return e}function f(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function b(e){return i(e)||o(e)||u(e)||s()}function i(e){if(Array.isArray(e))return a(e)}function o(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function u(e,t){if(!e)return;if(typeof e==="string")return a(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return a(e,t)}function a(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function w(e,t){var r=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=u(e))||t&&e&&typeof e.length==="number"){if(r)e=r;var n=0;var i=function(){};return{s:i,n:function(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,a=false,f;return{s:function(){r=r.call(e)},n:function(){var e=r.next();o=e.done;return e},e:function(e){a=true;f=e},f:function(){try{if(!o&&r.return!=null)r.return()}finally{if(a)throw f}}}}var l={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};var c={stopPropagation:function(e){e=e||window.event;if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}},preventDefault:function(e){e=e||window.event;if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},isNode:function(e){return e&&(e.nodeType===1||e.nodeType===9||e.nodeType===11)},bind:function(e,t,r){if(e.constructor===Array||e.constructor===NodeList||e.constructor===HTMLCollection){for(var n=0;n<e.length;n++){this.bind(e[n],t,r)}return}if(window.attachEvent)e.attachEvent("on"+t,r);else e.addEventListener(t,r,false)},unbind:function(e,t,r){if(e.constructor===Array||e.constructor===NodeList||e.constructor===HTMLCollection){for(var n=0;n<e.length;n++){this.unbind(e[n],t,r)}return}if(window.detachEvent)e.detachEvent("on"+t,r);else e.removeEventListener(t,r,false)},find:function(e,t,r){if(!this.isNode(e))return[];var n=e.getElementsByTagName(r||"*");var i=[];for(var o=0;o<n.length;o++){if(this.isNode(n[o])&&(typeof t!="function"||t(n[o])))i.push(n[o])}return i},children:function(e,t){var r=e.childNodes;var n=[];for(var i=0;i<r.length;i++){if(this.isNode(r[i])&&(typeof t!="function"||t(r[i])))n.push(r[i])}return n},hasClass:function(e,t,r){if(t.constructor!==Array)t=[t];var n=" "+(e.getAttribute("class")||"")+" ";for(var i=0;i<t.length;i++){if(n.indexOf(" "+t[i]+" ")>=0){if(r)return true}else{if(!r)return false}}return true},removeClass:function(e,t){var r=" "+(e.getAttribute("class")||"")+" ";var n=r.replace(" "+t.trim()+" "," ");e.setAttribute("class",n.trim())},addClass:function(e,t){if(this.hasClass(e,t))return;var r=e.getAttribute("class")||"";e.setAttribute("class",r+" "+t)},toNode:function(e,t){var r;if(t)r=document.createElementNS(l.svg,"svg");else{var n="div";if(/^<tr[> ]/.test(e)){n="tbody"}else if(/^<th[> ]/.test(e)||/^<td[> ]/.test(e)){n="tr"}else if(/^<thead[> ]/.test(e)||/^<tbody[> ]/.test(e)){n="table"}r=document.createElement(n)}r.innerHTML=e;var i=r.childNodes;for(var o=0;o<i.length;o++){if(this.isNode(i[o]))return i[o]}},trigger:function(e,t){if(document.createEventObject){e.fireEvent("on"+t,document.createEventObject())}else{var r=document.createEvent("HTMLEvents");r.initEvent(t,true,false);e.dispatchEvent(r)}},getStyle:function(e,t){var r=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null):e.currentStyle;return typeof t==="string"?r.getPropertyValue(t):r},offsetPosition:function(e){var t=0;var r=0;r=e.offsetTop;t=e.offsetLeft;e=e.offsetParent;while(e){r+=e.offsetTop;t+=e.offsetLeft;e=e.offsetParent}return{left:t,top:r}},mousePosition:function(e,t){var r=e.getBoundingClientRect();if(!t||!t.clientX)throw new Error("Event is necessary!");return{x:t.clientX-r.left,y:t.clientY-r.top}},remove:function(e){e.parentNode.removeChild(e)},setStyles:function(e,t){for(var r in t)e.style[r]=t[r]},size:function(e,t){var r,n;if(t=="content"){n=e.clientWidth-(this.getStyle(e,"padding-left")+"").replace("px","")-(this.getStyle(e,"padding-right")+"").replace("px","");r=e.clientHeight-(this.getStyle(e,"padding-top")+"").replace("px","")-(this.getStyle(e,"padding-bottom")+"").replace("px","")}else if(t=="padding"){n=e.clientWidth;r=e.clientHeight}else if(t=="border"){n=e.offsetWidth;r=e.offsetHeight}else if(t=="scroll"){n=e.scrollWidth;r=e.scrollHeight}else{n=e.offsetWidth;r=e.offsetHeight}return{width:n,height:r}},append:function(e,t){var r=this.isNode(t)?t:this.toNode(t);e.appendChild(r);return r},prepend:function(e,t){var r=this.isNode(t)?t:this.toNode(t);e.insertBefore(r,e.childNodes[0]);return r},after:function(e,t){var r=this.isNode(t)?t:this.toNode(t);e.parentNode.insertBefore(r,e.nextSibling);return r},before:function(e,t){var r=this.isNode(t)?t:this.toNode(t);e.parentNode.insertBefore(r,e);return r}};var v=true;function h(e,r){var t=null;var n=false;var i=false;var o=function e(){if(!n){n=true;var t=window.setInterval(function(){if(!i){window.clearInterval(t);n=false;r()}i=false},100)}else{i=true}};try{t=new ResizeObserver(o);t.observe(e)}catch(e){if(v){console.error("ResizeObserver undefined!");v=false}o();window.addEventListener("resize",o,false)}return function(){if(t){t.disconnect()}}}var d={whitespace:"[\\x20\\t\\r\\n\\f]"};function p(e,t){var r=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null):e.currentStyle;return typeof t==="string"?r.getPropertyValue(t):r}function m(e){var t=document.getElementsByTagName("head")[0];t.style["color"]=e;var r=p(t,"color");var n=r.replace(/^rgba?\(([^)]+)\)$/,"$1").split(new RegExp("\\,"+d.whitespace));return[+n[0],+n[1],+n[2],n[3]==undefined?1:+n[3]]}function g(e){var t=typeof e;return e!=null&&(t==="object"||t==="function")}var y=Object.prototype.toString;function x(e){if(e==null){return e===undefined?"[object Undefined]":"[object Null]"}return y.call(e)}function E(e){return e===true||e===false||e!==null&&typeof e==="object"&&x(e)==="[object Boolean]"}function _(e){var t=typeof e;return t==="string"||t==="object"&&e!=null&&!Array.isArray(e)&&x(e)==="[object String]"}var A=g;var T=E;var S=_;var L=function(e){return Array.isArray(e)};function P(e){if(L(e))return e;var t=m(e);return[t[0]/255,t[1]/255,t[2]/255,t[3]]}var U=function(e){var t={colors:[]};if("colors"in e){var r=w(e.colors),n;try{for(r.s();!(n=r.n()).done;){var i=n.value;t.colors.push(P(i))}}catch(e){r.e(e)}finally{r.f()}}return t};var I={blankReg:new RegExp("[\\x20\\t\\r\\n\\f]"),blanksReg:/^[\x20\t\r\n\f]{0,}$/,identifier:/^[a-zA-Z_$][0-9a-zA-Z_$]{0,}$/};var N=["+","-","*","/","%","&","|","!","?",":","[","]","(",")",">","<","="];var M=["+","-","*","/","%","&","|","!","?",":",">","<","=","<=",">=","==","===","!=","!=="];function R(e,t,r){t=t.trim();var n=-1,i=null;var o=function(){i=n++<t.length-1?t[n]:null;return i};var a=function(e){return t.substring(n,e+n>t.length?t.length:e+n)};o();var f=[];while(true){if(n>=t.length)break;if(N.indexOf(i)>-1){if(["&","|","="].indexOf(i)>-1){if(["==="].indexOf(a(3))>-1){f.push(a(3));n+=2;o()}else if(["&&","||","=="].indexOf(a(2))>-1){f.push(a(2));n+=1;o()}else{throw new Error("Illegal expression : "+t+"\nstep='analyseExpress',index="+n)}}else{if(["!=="].indexOf(a(3))>-1){f.push(a(3));n+=2;o()}else if([">=","<=","!="].indexOf(a(2))>-1){f.push(a(2));n+=1;o()}else{f.push(i);o()}}}else if(['"',"'"].indexOf(i)>-1){var u="",s=i;o();while(i!=s){if(n>=t.length){throw new Error("String unclosed error : "+t+"\nstep='analyseExpress',index="+n)}u+=i;o()}f.push(u+"@string");o()}else if(/\d/.test(i)){var l="no";var u=i;o();while(n<t.length){if(/\d/.test(i)){u+=i;if(l=="error")l="yes"}else if("."==i&&l=="no"){u+=i;l="error"}else{break}o()}if(l=="error")u+="0";f.push(+u)}else if(["null","true"].indexOf(a(4))>-1){f.push({null:null,true:true}[a(4)]);n+=3;o()}else if(["false"].indexOf(a(5))>-1){f.push({false:false}[a(5)]);n+=4;o()}else if(["undefined"].indexOf(a(9))>-1){f.push({undefined:undefined}[a(9)]);n+=8;o()}else if(I.blankReg.test(i)){do{o()}while(I.blankReg.test(i)&&n<t.length)}else{var c=false;if(i=="."){c=true;o()}if(I.identifier.test(i)){var v=1;while(n+v<=t.length&&I.identifier.test(a(v)))v+=1;if(c){f.push("[");f.push(a(v-1)+"@string");f.push("]")}else{var h=a(v-1);var d=h in r?r[h]:e[h];f.push(S(d)?d+"@string":d)}n+=v-2;o()}else{throw new Error("Illegal express : "+t+"\nstep='analyseExpress',index="+n)}}}var p=0;for(var m=0;m<f.length;m++){if(["+","-"].indexOf(f[m])>-1&&(m==0||M.indexOf(f[p-1])>-1)){f[p++]=+(f[m]+f[m+1]);m+=1}else{f[p++]=f[m]}}f.length=p;return f}var z=function(e){if(typeof e=="string")return e.replace(/@string$/,"");return e};var B=function(e){if(typeof e=="string")return e+"@string";return e};function C(e){var t=0,r=0;for(;r<e.length;r++){if(e[r]=="!"){e[t]=!e[++r]}else e[t]=e[r];t+=1}if(t==1)return z(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="*"){e[t-1]=z(e[t-1])*z(e[++r])}else if(e[r]=="/"){e[t-1]=z(e[t-1])/z(e[++r])}else if(e[r]=="%"){e[t-1]=z(e[t-1])%z(e[++r])}else{e[t++]=e[r]}}if(t==1)return z(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="+"){e[t-1]=B(z(e[t-1])+z(e[++r]))}else if(e[r]=="-"){e[t-1]=z(e[t-1])-z(e[++r])}else e[t++]=e[r]}if(t==1)return z(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]==">"){e[t-1]=z(e[t-1])>z(e[++r])}else if(e[r]=="<"){e[t-1]=z(e[t-1])<z(e[++r])}else if(e[r]=="<="){e[t-1]=z(e[t-1])<=z(e[++r])}else if(e[r]==">="){e[t-1]=z(e[t-1])>=z(e[++r])}else e[t++]=e[r]}if(t==1)return z(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="=="){e[t-1]=z(e[t-1])==z(e[++r])}else if(e[r]=="==="){e[t-1]=z(e[t-1])===z(e[++r])}else if(e[r]=="!="){e[t-1]=z(e[t-1])!=z(e[++r])}else if(e[r]=="!=="){e[t-1]=z(e[t-1])!==z(e[++r])}else e[t++]=e[r]}if(t==1)return z(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="&&"){e[t-1]=z(e[t-1])&&z(e[1+r]);r+=1}else if(e[r]=="||"){e[t-1]=z(e[t-1])||z(e[1+r]);r+=1}else e[t++]=e[r]}if(t==1)return z(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="?"){e[t-1]=z(e[t-1])?z(e[r+1]):z(e[r+3]);r+=3}else e[t++]=e[r]}if(t==1)return z(e[0]);e.length=t;throw new Error("Unrecognized expression : ["+e.toString()+"]")}function O(t,r,n){var e=r[0]in n?n[r[0]]:t[r[0]];for(var i=1;i<r.length;i++){try{e=e[r[i]]}catch(e){console.error({target:t,scope:n,expressArray:r,index:i});throw e}}return e}var D=function(e,t,r){if(t.indexOf("(")>-1){var n=[],i=[],o=0;for(var a=0;a<t.length;a++){if(t[a]=="("){if(o>0){i.push("(")}o+=1}else if(t[a]==")"){if(o>1)i.push(")");o-=1;if(o==0){var f=C(D(e,i));n.push(S(f)?f+"@string":f);i=[]}}else{if(o>0)i.push(t[a]);else n.push(t[a])}}t=n}return F(t)};var F=function(e){var t=true;while(t){t=false;var r=[],n=[],i=false;for(var o=0;o<e.length;o++){if(e[o]=="["&&o!=0&&e[o-1]!="]"){if(i){r.push("[");for(var a=0;a<n.length;a++)r.push(n[a])}else{i=true}n=[]}else if(e[o]=="]"&&i){t=true;var f=C(n);var u=r[r.length-1][f];r[r.length-1]=S(u)?u+"@string":u;i=false}else{if(i){n.push(e[o])}else{r.push(e[o])}}}e=r}return e};var k=function(e){var t=[],r=[];for(var n=0;n<e.length;n++){if(e[n]=="["){r=[]}else if(e[n]=="]"){t.push(C(r))}else{r.push(e[n])}}return t};function j(e,t,r){var n=D(e,t);var i;if(n[0]!="["){i=[C(n)]}else if(n[n.length-1]=="]"){i=k(n)}else{var o=n.lastIndexOf("]");var a=k(n.slice(0,o+1));var f=n.slice(o+1);f.unshift(O(e,a,r));i=[C(f)]}return i}var G=function(e,t,r){if(arguments.length<3)r={};var n=R(e,t,r);var i=j(e,n,r);return O(e,i,r)};var V=function(e,t,r,n){if(arguments.length<4)n={};var i=R(e,t,n);var o=j(e,i,n);var a=e;for(var f=0;f<o.length-1;f++){if(!(o[f]in a))a[o[f]]=L(a)?[]:{};a=a[o[f]]}a[o[o.length-1]]=r;return e};function X(o,e){(function e(t,r){for(var n in r){var i=t+"['"+n+"']";if(A(r[n])&&!L(r[n])){if(!G(o,i)){V(o,i,{})}e(i,r[n])}else{V(o,i,r[n])}}})("",e);return o}function H(e,t){return t={exports:{}},e(t,t.exports),t.exports}var Y=H(function(g){(function(){function t(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){t=function(e){return typeof e}}else{t=function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return t(e)}function p(e){return r(e)||n(e)||i(e)||a()}function r(e){if(Array.isArray(e))return o(e)}function n(e){if(typeof Symbol!=="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function i(e,t){if(!e)return;if(typeof e==="string")return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(e,t)}function o(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function a(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f=Object.prototype.toString;function u(e){if(e==null){return e===undefined?"[object Undefined]":"[object Null]"}return f.call(e)}function e(e){return typeof e==="number"||e!==null&&t(e)==="object"&&u(e)==="[object Number]"}var l=e;var c={splitNum:function e(t,r){var n=Math.ceil(Math.PI*2/Math.asin(t/r)*2);return isNaN(n)||n<12?12:n}};function m(e,t,r,n,i){var o=Math.cos(r),a=Math.sin(r);return[(n-e)*o-(i-t)*a+e,(n-e)*a+(i-t)*o+t]}function v(e,t,r,n,i,o,a){var f,u;if(o==4){var s=i/1.414;f=t+s;u=n+s}else{f=t+i;u=n}var l=[t,r,n],c=Math.PI*2/o;if(e)l.push(0,a,0);l.push(f,r,u);if(e)l.push(0,a,0);for(var v=0;v<o;v++){var h=m(t,n,c*(v+1),f,u);l.push(h[0],r,h[1]);if(e)l.push(0,a,0)}return l}function h(e,t,r,n,i,o,a){var f=[];var u;if(a==4){u=m(t,n,Math.PI*.25,t-i,n)}else{u=[t+i,n]}var s=Math.PI*2/a,l=Math.PI*2/(a*2);var c,v=[];for(var h=0;h<a;h++){c=m.apply(void 0,[t,n,s].concat(p(u)));if(e){var d=m.apply(void 0,[t,n,l].concat(p(u)));v=[d[0],0,d[1]]}f.push.apply(f,[u[0],r,u[1]].concat(p(v)));f.push.apply(f,[u[0],r+o,u[1]].concat(p(v)));f.push.apply(f,[c[0],r+o,c[1]].concat(p(v)));f.push.apply(f,[u[0],r,u[1]].concat(p(v)));f.push.apply(f,[c[0],r,c[1]].concat(p(v)));f.push.apply(f,[c[0],r+o,c[1]].concat(p(v)));u=c}return f}function d(e,t,r,n,i,o,a){var f=[t,r+i,n],u=Math.PI*2/o,s;if(e)f.push(0,i,0);for(var l=1;l<o*.5;l++){s=m(t,r,u*l,t,r+i);var c=m(t,n,u*a,s[0],n);f.push(c[0],s[1],c[1]);if(e)f.push(c[0]-t,s[1]-r,c[1]-n);var v=m(t,n,u*(a+1),s[0],n);f.push(v[0],s[1],v[1]);if(e)f.push(v[0]-t,v[1]-r,v[1]-n)}f.push(t,r-i,n);if(e)f.push(0,-i,0);return f}var s=function e(u){if(!l(u.precision)||u<=0){throw new Error("options.precision should be an integer greater than zero")}var s={cylinder:function e(t,r,n,i,o,a){var f=c.splitNum(u.precision,o);s.prism(t,r,n,i,o,a,f);return s},prism:function e(t,r,n,i,o,a,f){t({points:v(u.normal,r,n,i,o,f,a>0?-1:1),length:f+2,methods:"FanTriangle"});t({points:v(u.normal,r,n+a,i,o,f,a>0?1:-1),length:f+2,methods:"FanTriangle"});t({points:h(u.normal,r,n,i,o,a,f),length:6*f,methods:"Triangle"});return s},sphere:function e(t,r,n,i,o){var a=c.splitNum(u.precision,o);for(var f=0;f<a;f++){t({points:d(u.normal,r,n,i,o,a,f),length:a+1,methods:"StripTriangle"})}return s}};return s};if(t(g)==="object"&&t(g.exports)==="object"){g.exports=s}else{window.ThreeGeometry=s}})()});var $=function(e,t){var a=Y({precision:.1,normal:true});var f=0;var u=0;var r=w(e),n;try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.type=="item"){if(i.name=="cuboid"){var o=Math.abs(i.start+i.length);var s=Math.max(Math.abs(Math.ceil(i.index+i.size*.5)),Math.abs(Math.floor(i.index-i.size*.5)));f=Math.max(f,o);u=Math.max(u,s)}else if(i.name=="lines"){var l=w(i.points),c;try{for(l.s();!(c=l.n()).done;){var v=c.value;var h=Math.abs(v[1]);var d=Math.ceil(Math.abs(v[0]));f=Math.max(f,h);u=Math.max(u,d)}}catch(e){l.e(e)}finally{l.f()}}}}}catch(e){r.e(e)}finally{r.f()}var p=[];var m=w(e),g;try{var y=function e(){var t=g.value;if(t.type=="item"){if(t.name=="cuboid"){a.prism(function(e){p.push({data:e,color:t.color})},t.index/u,t.start/f,0,1/u*t.size/2,t.length/f,4)}else if(t.name=="lines"){var r=[];var n=w(t.points),i;try{for(n.s();!(i=n.n()).done;){var o=i.value;r.push(o[0]/u,o[1]/f,0,0,0,1)}}catch(e){n.e(e)}finally{n.f()}p.push({data:{length:t.points.length,methods:"StripLine",points:r},color:t.color})}}else if(t.type=="native"){p.push({data:{length:t.points.length/6,methods:t.methods,points:t.points},color:P(t.color)})}else if(t.type=="geometry"){a[t.name].apply(a,[function(e){p.push({data:e,color:P(t.color)})}].concat(b(t.params)))}};for(m.s();!(g=m.n()).done;){y()}}catch(e){m.e(e)}finally{m.f()}return{geometry:p}};var W=H(function(M){var R=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};(function(){var f=function e(t,r,n){var i=t.createShader(r);if(i==null)throw new Error("Unable to create shader!");t.shaderSource(i,n);t.compileShader(i);if(!t.getShaderParameter(i,t.COMPILE_STATUS))throw new Error("Failed to compile shader:"+t.getShaderInfoLog(i));return i};var o=function e(t,r,n){var i=f(t,t.VERTEX_SHADER,r),o=f(t,t.FRAGMENT_SHADER,n);var a=t.createProgram();t.attachShader(a,i);t.attachShader(a,o);t.linkProgram(a);if(!t.getProgramParameter(a,t.LINK_STATUS))throw new Error("Failed to link program: "+t.getProgramInfoLog(a));t.useProgram(a);return a};var a=function e(t,r){var n=t.createBuffer(),i=r?t.ELEMENT_ARRAY_BUFFER:t.ARRAY_BUFFER;t.bindBuffer(i,n);return n};var c=function e(t,r,n,i){var o=i?t.ELEMENT_ARRAY_BUFFER:t.ARRAY_BUFFER;t.bufferData(o,r,n)};var v=function e(t,r,n,i,o,a,f){t.vertexAttribPointer(r,n,i,f||false,o||0,a||0);t.enableVertexAttribArray(r)};var s=function e(t,r,n,i){var o=t.createTexture();if(i=="2d"){n=n||0;t.activeTexture(t["TEXTURE"+n])}t.bindTexture(r,o);return o};var h=function e(t,r,n,i,o,a){i={rgb:t.RGB,rgba:t.RGBA,alpha:t.ALPHA}[i]||t.RGBA;t.texImage2D(r,n||0,i,i,{}[o]||t.UNSIGNED_BYTE,a)};var d=function e(t,r,n,i,o,a,f,u,s){i={rgb:t.RGB,rgba:t.RGBA,alpha:t.ALPHA}[i]||t.RGBA;n=n||0;o={}[o]||t.UNSIGNED_BYTE;var l=[t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_Z],c=void 0,v=void 0;for(c=0;c<l.length;c++){v=l[c];t.texImage2D(v,n,i,f,u,0,i,o,null);t.bindTexture(r,s);t.texImage2D(v,n,i,i,o,a[c])}t.generateMipmap(r)};function u(f){return{setAttribute1f:function e(t,r){var n=f.getAttribLocation(f.program,t);f.vertexAttrib1f(n,r)},setAttribute2f:function e(t,r,n){var i=f.getAttribLocation(f.program,t);f.vertexAttrib2f(i,r,n)},setAttribute3f:function e(t,r,n,i){var o=f.getAttribLocation(f.program,t);f.vertexAttrib3f(o,r,n,i)},setAttribute4f:function e(t,r,n,i,o){var a=f.getAttribLocation(f.program,t);f.vertexAttrib4f(a,r,n,i,o)},setAttribute1i:function e(t,r){var n=f.getAttribLocation(f.program,t);f.vertexAttrib1i(n,r)},setAttribute2i:function e(t,r,n){var i=f.getAttribLocation(f.program,t);f.vertexAttrib2i(i,r,n)},setAttribute3i:function e(t,r,n,i){var o=f.getAttribLocation(f.program,t);f.vertexAttrib3i(o,r,n,i)},setAttribute4i:function e(t,r,n,i,o){var a=f.getAttribLocation(f.program,t);f.vertexAttrib4i(a,r,n,i,o)},setUniform1f:function e(t,r){var n=f.getUniformLocation(f.program,t);f.uniform1f(n,r)},setUniform2f:function e(t,r,n){var i=f.getUniformLocation(f.program,t);f.uniform2f(i,r,n)},setUniform3f:function e(t,r,n,i){var o=f.getUniformLocation(f.program,t);f.uniform3f(o,r,n,i)},setUniform4f:function e(t,r,n,i,o){var a=f.getUniformLocation(f.program,t);f.uniform4f(a,r,n,i,o)},setUniform1i:function e(t,r){var n=f.getUniformLocation(f.program,t);f.uniform1i(n,r)},setUniform2i:function e(t,r,n){var i=f.getUniformLocation(f.program,t);f.uniform2i(i,r,n)},setUniform3i:function e(t,r,n,i){var o=f.getUniformLocation(f.program,t);f.uniform3i(o,r,n,i)},setUniform4i:function e(t,r,n,i,o){var a=f.getUniformLocation(f.program,t);f.uniform4i(a,r,n,i,o)},setUniformMatrix2fv:function e(t,r){var n=f.getUniformLocation(f.program,t);f.uniformMatrix2fv(n,false,r)},setUniformMatrix3fv:function e(t,r){var n=f.getUniformLocation(f.program,t);f.uniformMatrix3fv(n,false,r)},setUniformMatrix4fv:function e(t,r){var n=f.getUniformLocation(f.program,t);f.uniformMatrix4fv(n,false,r)}}}function p(i){var o={byte:i.UNSIGNED_BYTE,short:i.UNSIGNED_SHORT};return{openDeep:function e(){i.enable(i.DEPTH_TEST);return this},points:function e(t,r,n){if(n){i.drawElements(i.POINTS,r,o[n],t)}else{i.drawArrays(i.POINTS,t,r)}return this},lines:function e(t,r,n){if(n){i.drawElements(i.LINES,r,o[n],t)}else{i.drawArrays(i.LINES,t,r)}return this},stripLines:function e(t,r,n){if(n){i.drawElements(i.LINE_STRIP,r,o[n],t)}else{i.drawArrays(i.LINE_STRIP,t,r)}return this},loopLines:function e(t,r,n){if(n){i.drawElements(i.LINE_LOOP,r,o[n],t)}else{i.drawArrays(i.LINE_LOOP,t,r)}return this},triangles:function e(t,r,n){if(n){i.drawElements(i.TRIANGLES,r,o[n],t)}else{i.drawArrays(i.TRIANGLES,t,r)}return this},stripTriangles:function e(t,r,n){if(n){i.drawElements(i.TRIANGLE_STRIP,r,o[n],t)}else{i.drawArrays(i.TRIANGLE_STRIP,t,r)}return this},fanTriangles:function e(t,r,n){if(n){i.drawElements(i.TRIANGLE_FAN,r,o[n],t)}else{i.drawArrays(i.TRIANGLE_FAN,t,r)}return this}}}var m=function e(t,r){var n=["webgl","experimental-webgl","webkit-3d","moz-webgl"],i=null,o=void 0;for(o=0;o<n.length;o++){try{i=t.getContext(n[o],r)}catch(e){}if(i)break}if(!i)throw new Error("Non canvas or browser does not support webgl.");return i};function l(e,t){var l=m(e,t),n={_gl_:l,painter:function e(){return p(l)},shader:function e(t,r){l.program=o(l,t,r);return n},buffer:function e(n){a(l,n);var u=void 0,s={write:function e(t,r){r=r||l.STATIC_DRAW;c(l,t,r,n);u=t;return s},use:function e(t,r,n,i,o,a){var f=u.BYTES_PER_ELEMENT;if(typeof t=="string")t=l.getAttribLocation(l.program,t);n=n||0;i=i||0;o=o||l.FLOAT;v(l,t,r,o,n*f,i*f,a);return s}};return s},texture:function f(e,t){var u={"2d":l.TEXTURE_2D,cube:l.TEXTURE_CUBE_MAP}[e];var f=s(l,u,t,e);l.texParameteri(u,l.TEXTURE_MIN_FILTER,l.NEAREST);l.texParameteri(u,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE);l.texParameteri(u,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE);var o={useImage:function e(t,r,n,i){h(l,u,r,n,i,t);return o},useCube:function e(t,r,n,i,o,a){d(l,u,i,o,a,t,r,n,f)}};return o}};var r=u(l);for(var i in r){n[i]=r[i]}l.viewport(0,0,l.canvas.width,l.canvas.height);l.depthFunc(l.LEQUAL);return n}function g(e,t){for(var r in t){try{e[r]=t[r]}catch(e){throw new Error("Illegal property key : "+r)}}return e}function y(r,e){return function(t){return new function e(){var i=this;var o=r.buffer(t);this.write=function(e){o.write(e);return i};if(!t){this.use=function(e,t,r,n){o.use(e,t,r,n);return i}}}}}function b(e,t,r,n){n=n||0;var i=Math.sqrt(t*t+r*r+n*n);return[1,0,0,0,0,1,0,0,0,0,1,0,t*e/i,r*e/i,n*e/i,1]}function w(e){var t=Math.sin(e),r=Math.cos(e);return[r,t,0,0,-t,r,0,0,0,0,1,0,0,0,0,1]}function x(e,t,r,n,i,o){n=n||0;i=i||0;o=o||0;return[e,0,0,0,0,t,0,0,0,0,r,0,n-n*e,i-i*t,o-o*r,1]}function E(e,t,r,n,i,o){if(typeof e==="number"&&typeof t==="number"){if(typeof r!=="number"){r=0;n=e;i=t;o=1}else if(typeof n!=="number"||typeof i!=="number"||typeof o!=="number"){n=e;i=t;o=r;e=0;t=0;r=0}if(e==n&&t==i&&r==o)throw new Error("It's not a legitimate ray!");var a=Math.sqrt((n-e)*(n-e)+(i-t)*(i-t)),f=a!=0?(i-t)/a:1,u=a!=0?(n-e)/a:0,s=(n-e)*u+(i-t)*f,l=o-r,c=Math.sqrt(s*s+l*l),v=c!=0?l/c:1,h=c!=0?s/c:0;return[[f,v*u,u*h,0,-u,f*v,f*h,0,0,-h,v,0,t*u-e*f,r*h-e*u*v-t*f*v,-e*u*h-t*f*h-r*v,1],[f,-u,0,0,v*u,v*f,-h,0,u*h,f*h,v,0,e,t,r,1]]}else{throw new Error("a1 and b1 is required!")}}var _=function e(t,r){var n=[];for(var i=0;i<4;i++){for(var o=0;o<r.length/4;o++){n[o*4+i]=t[i]*r[o*4]+t[i+4]*r[o*4+1]+t[i+8]*r[o*4+2]+t[i+12]*r[o*4+3]}}return n};function A(e){var s=e||[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];var l={move:function e(t,r,n,i){s=_(b(t,r,n,i),s);return l},rotate:function e(t,r,n,i,o,a,f){var u=E(r,n,i,o,a,f);s=_(_(_(u[1],w(t)),u[0]),s);return l},scale:function e(t,r,n,i,o,a){s=_(x(t,r,n,i,o,a),s);return l},multiply:function e(t,r){s=r?_(s,t):_(t,s);return l},use:function e(t,r,n,i){n=n||0;i=i||1;var o=_(s,[t,r,n,i]);o[0]=+o[0].toFixed(7);o[1]=+o[1].toFixed(7);o[2]=+o[2].toFixed(7);o[3]=+o[3].toFixed(7);return o},value:function e(){return s}};return l}var T=function e(t){return Array.isArray(t)};function S(i,e){return function(){var r=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return new function e(){var f=this;var n=i._gl_.canvas.clientWidth/i._gl_.canvas.clientHeight;if(T(r.size)){r.size=r.size[0];console.warn('"options.size" should be a number. The writing of array is out of date: https://hai2007.gitee.io/image3d/index.html#/api?fixed=camera-set')}if(!("size"in r)){r.size=1}var u=A();var t=r.proof?-1:1;u.multiply([1/r.size,0,0,0,0,1/r.size,0,0,0,0,t/r.size,0,0,0,0,1]);this.setProportion=function(e){n=e;return f};this.rotateEye=function(e,t,r,n,i,o,a){u.rotate(-e,t,r,n,i,o,a);return f};this.moveEye=function(e,t,r,n){u.move(-e,t,r,n);return f};this.rotateBody=function(e,t,r,n,i,o,a){u.rotate(e,t,r,n,i,o,a);return f};this.moveBody=function(e,t,r,n){u.move(e,t,r,n);return f};this.scaleBody=function(e,t,r,n,i,o){u.scale(e,t,r,n,i,o);return f};this.value=function(){var e=1;var t=1;if(n>1){t=n}else{e=1/n}var r=Math.max(e,t);return A(u.value()).multiply([e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1]).value()}}}}function n(r,n){n.drawPoint=function(e,t){r.points(e,t);return n};n.drawLine=function(e,t){r.lines(e,t);return n};n.drawStripLine=function(e,t){r.stripLines(e,t);return n};n.drawLoopLine=function(e,t){r.loopLines(e,t);return n};n.drawTriangle=function(e,t){r.triangles(e,t);return n};n.drawStripTriangle=function(e,t){r.stripTriangles(e,t);return n};n.drawFanTriangle=function(e,t){r.fanTriangles(e,t);return n}}function i(n,i){i.elemPoint=function(e,t,r){r=r||"byte";n.points(e,t,r);return i};i.elemLine=function(e,t,r){r=r||"byte";n.lines(e,t,r);return i};i.elemStripLine=function(e,t,r){r=r||"byte";n.stripLines(e,t,r);return i};i.elemLoopLine=function(e,t,r){r=r||"byte";n.loopLines(e,t,r);return i};i.elemTriangle=function(e,t,r){r=r||"byte";n.triangles(e,t,r);return i};i.elemStripTriangle=function(e,t,r){r=r||"byte";n.stripTriangles(e,t,r);return i};i.elemFanTriangle=function(e,t,r){r=r||"byte";n.fanTriangles(e,t,r);return i}}function L(e,t){var r=e.painter();if(t.depth){r.openDeep()}return function(){return new function e(){n(r,this);i(r,this)}}}function P(i,e){return function(n){return new function e(){var t=this;var r=i.texture("2d",n);this.write=function(e){r.useImage(e);return t}}}}function U(t,e){return function(u,s){return new function e(){var a=this;var f=t.texture("cube");this.write=function(e,t,r,n,i,o){f.useCube([e,t,r,n,i,o],u,s);return a}}}}var t={vs:"\n    attribute vec4 a_position;\n    attribute vec4 a_color;\n    attribute float a_size;\n    varying vec4 v_color;\n    void main(){\n        gl_Position=a_position;\n        gl_PointSize=a_size;\n        v_color=a_color;\n    }\n    ",fs:"\n    precision mediump float;\n    varying vec4 v_color;\n    void main(){\n        gl_FragColor=v_color;\n    }\n    "};var r={vs:"\n    attribute vec4 a_position;\n    attribute vec4 a_color;\n    attribute float a_size;\n    varying vec4 v_color;\n    uniform mat4 u_matrix;\n    void main(){\n        gl_Position=u_matrix * a_position;\n        gl_PointSize=a_size;\n        v_color=a_color;\n    }\n    ",fs:"\n    precision mediump float;\n    varying vec4 v_color;\n    void main(){\n        gl_FragColor=v_color;\n    }\n    "};function I(e){return{type_default:t,type_camera:r}["type_"+e]}var e=function e(t,r){var n=g({depth:false},r||{});var o=l(t);var i=n["vertex-shader"],a=n["fragment-shader"];if(!i||!a){var f=I(n.shader||"default");i=f.vs;a=f.fs}o.shader(i,a);e.fn=e.prototype;e.fn.Buffer=y(o);e.fn.Camera=S(o);e.fn.Painter=L(o,n);e.fn.Texture2D=P(o);e.fn.TextureCube=U(o);e.fn.setAttributeFloat=function(e,t,r,n,i){o["setAttribute"+(arguments.length-1)+"f"](e,t,r,n,i);return this};e.fn.setAttributeInt=function(e,t,r,n,i){o["setAttribute"+(arguments.length-1)+"i"](e,t,r,n,i);return this};e.fn.setUniformFloat=function(e,t,r,n,i){o["setUniform"+(arguments.length-1)+"f"](e,t,r,n,i);return this};e.fn.setUniformInt=function(e,t,r,n,i){o["setUniform"+(arguments.length-1)+"i"](e,t,r,n,i);return this};e.fn.setUniformMatrix=function(e,t){var r={4:2,9:3,16:4}[t.length];o["setUniformMatrix"+r+"fv"](e,t);return this}};e.core=l;if(R(M)==="object"&&R(M.exports)==="object"){M.exports=e}else{var N=window.image3D;e.noConflict=function(){if(window.image3D===e){window.image3D=N}return e};window.image3D=e}})()});var K={48:[0,")"],49:[1,"!"],50:[2,"@"],51:[3,"#"],52:[4,"$"],53:[5,"%"],54:[6,"^"],55:[7,"&"],56:[8,"*"],57:[9,"("],96:[0,0],97:1,98:2,99:3,100:4,101:5,102:6,103:7,104:8,105:9,106:"*",107:"+",109:"-",110:".",111:"/",65:["a","A"],66:["b","B"],67:["c","C"],68:["d","D"],69:["e","E"],70:["f","F"],71:["g","G"],72:["h","H"],73:["i","I"],74:["j","J"],75:["k","K"],76:["l","L"],77:["m","M"],78:["n","N"],79:["o","O"],80:["p","P"],81:["q","Q"],82:["r","R"],83:["s","S"],84:["t","T"],85:["u","U"],86:["v","V"],87:["w","W"],88:["x","X"],89:["y","Y"],90:["z","Z"],37:"left",38:"up",39:"right",40:"down",33:"page up",34:"page down",35:"end",36:"home",16:"shift",17:"ctrl",18:"alt",91:"command",92:"command",93:"command",224:"command",9:"tab",20:"caps lock",32:"spacebar",8:"backspace",13:"enter",27:"esc",46:"delete",45:"insert",144:"number lock",145:"scroll lock",12:"clear",19:"pause",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",189:["-","_"],187:["=","+"],219:["[","{"],221:["]","}"],220:["\\","|"],186:[";",":"],222:["'",'"'],188:[",","<"],190:[".",">"],191:["/","?"],192:["`","~"]};var q=["shift","ctrl","alt"];function Z(e){e=e||window.event;var t=e.keyCode||e.which;var r=K[t]||t;if(!r)return;if(r.constructor!==Array)r=[r,r];var n=r[0];var i=e.shiftKey?"shift+":"",o=e.altKey?"alt+":"",a=e.ctrlKey?"ctrl+":"";var f="",u=a+i+o;if(q.indexOf(r[0])>=0){r[0]=r[1]=""}var s=e.code=="Key"+e.key&&!i;f=u+(u==""&&s?r[1]:r[0]);if(r[0]==""){f=f.replace(/\+$/,"")}return f==""?n:f}function Q(i){var o=document.getElementsByTagName("body")[0];c.bind(o,"keydown",function(e){var t=Z(e);if(t=="up"){i({type:"lookUp"})}else if(t=="down"){i({type:"lookDown"})}else if(t=="left"){i({type:"lookLeft"})}else if(t=="right"){i({type:"lookRight"})}});var a=null;var t=function(e){if(a==null)return;var t=c.mousePosition(o,e);var r=[t.x-a.x,a.y-t.y];var n=[r[1],r[0]*-1,0];if(n[0]==0&&n[1]==0)return;i({type:"rotate",normal:n,dist:Math.abs(t.x-a.x)+Math.abs(t.y-a.y)});a=t};c.bind(o,"mousedown",function(e){a=c.mousePosition(o,e)});c.bind(o,"mouseup",function(e){a=null});c.bind(o,"mousemove",function(e){t(e)});c.bind(o,"touchend",function(e){a=null});c.bind(o,"touchstart",function(e){a=c.mousePosition(o,e.touches[0])});c.bind(o,"touchmove",function(e){t(e.touches[0])});let r=function(e){if(e==0)return;i({type:"scale",kind:e<0?"reduce":"enlarge",rate:Math.abs(e)})};c.bind(o,"mousewheel",function(e){r(e.wheelDelta)});if(window.addEventListener){window.addEventListener("DOMMouseScroll",function(e){r(-1*e.detail)},false)}}var J="\n\n    attribute vec4 a_position; // 顶点坐标\n    uniform mat4 u_matrix;     // 变换矩阵\n    uniform vec3 u_LPosition;  // 光的位置\n    attribute vec3 a_normal;\n\n    varying vec3 v_LDirection;\n    varying vec3 v_normal;\n\n    attribute vec2 a_textcoord; // 纹理映射\n    varying vec2 v_textcoord;\n\n    void main(){\n\n        vec4 temp = u_matrix * a_position;\n\n        // 表示眼睛距离vec4(0.0,0.0,1.0)的距离\n        float dist = 2.0;\n\n        // 使用投影直接计算\n        // 此处要注意z轴承显示和实际的方向是相反的\n        gl_Position = vec4((dist + 1.0) * temp.x / (dist + temp.z), (dist + 1.0) * temp.y / (dist + temp.z), temp.z, 1.0);\n\n        // 点光源方向\n        // 顶点的位置应该使用计算过的\n        v_LDirection = vec3(gl_Position) - u_LPosition;\n\n        v_normal = vec3(u_matrix * vec4(a_normal, 1));\n\n        v_textcoord=a_textcoord;\n\n    }\n";var ee="\n    precision mediump float;\n\n    uniform vec4 u_LColor; // 光颜色\n    uniform vec4 u_color;  // 顶点颜色\n\n    varying vec3 v_LDirection; // 光线方向\n    varying vec3 v_normal;     // 法线方向\n\n    uniform sampler2D u_sampler; // 纹理单元\n    varying vec2 v_textcoord;\n\n    uniform int textureType; // 纹理类型，1无，2二维纹理\n\n    void main()\n    {\n\n        // 先对方向进行序列化，使得向量长度为1\n        vec3 LDirection = normalize(v_LDirection);\n        vec3 normal = normalize(v_normal);\n\n        // 计算序列化后的光方向和法线方向的点乘\n        float dotValue = max(abs(dot(LDirection, normal)), 0.4);\n\n        vec4 color = u_color;\n\n        // 二维纹理\n        if(textureType==2){\n            color = texture2D(u_sampler, v_textcoord);\n        }\n\n        gl_FragColor = color * u_LColor * dotValue;\n\n\n    }\n";var te=function(e){var t=[];if(e.value){var r=1/Math.ceil(e.value.length/2);for(var n=0;n<e.value.length;n++){t.push({type:"text",color:"white",content:e.value[n],x:(n-(e.value.length-1)*.5)*r,y:0,z:.1,d:"z"})}}return[{data:{length:2,methods:"Line",points:[-1.3,0,0,0,0,1,1.3,0,0,0,0,1]},color:[1,0,0,1]},{data:{length:6,methods:"FanTriangle",points:[1.3,0,0,0,0,1,1.25,.02,.02,0,0,1,1.25,-.02,.02,0,0,1,1.25,-.02,-.02,0,0,1,1.25,.02,-.02,0,0,1,1.25,.02,.02,0,0,1]},color:[1,0,0,1]}].concat(t)};var re=function(){return[{data:{length:2,methods:"Line",points:[0,-1.3,0,0,0,1,0,1.3,0,0,0,1]},color:[0,1,0,1]},{data:{length:6,methods:"FanTriangle",points:[0,1.3,0,0,0,1,.02,1.25,.02,0,0,1,-.02,1.25,.02,0,0,1,-.02,1.25,-.02,0,0,1,.02,1.25,-.02,0,0,1,.02,1.25,.02,0,0,1]},color:[0,1,0,1]}]};var ne=function(){return[{data:{length:2,methods:"Line",points:[0,0,-1.3,0,0,1,0,0,1.3,0,0,1]},color:[0,0,1,1]},{data:{length:6,methods:"FanTriangle",points:[0,0,1.3,0,0,1,.02,.02,1.25,0,0,1,-.02,.02,1.25,0,0,1,-.02,-.02,1.25,0,0,1,.02,-.02,1.25,0,0,1,.02,.02,1.25,0,0,1]},color:[0,0,1,1]}]};var ie={xAxis:te,yAxis:re,zAxis:ne};var oe=function(e){var t=document.createElement("canvas");var r=16;var n=e.content.length*r;t.width=n;t.height=r;var i=t.getContext("2d");i.font=r*.9+"px sans-serif";i.textBaseline="middle";i.textAlign="center";i.fillStyle=e.color;i.clearRect(0,0,n,r);i.fillText(e.content,n*.5,r*.5);return{data:t,width:n,height:r}};var ae=function(e,t){var r=e.data;e.itemStyle=e.itemStyle||{};var n=[];for(var i=0;i<r.length;i++){if(L(r[i])){for(var o=0;o<r[i].length;o++){var a=.7/r[i].length;n.push({type:"item",name:"cuboid",length:r[i][o],start:e.itemStyle.align=="middle"?r[i][o]*.5:0,index:i+.5-r.length*.5+(o-r[i].length*.5)*a,size:a,color:t.color(o)})}}else{n.push({type:"item",name:"cuboid",length:r[i],start:e.itemStyle.align=="middle"?r[i]*.5:0,index:i+.5-r.length*.5,size:.7,color:e.itemStyle.colors?t.color(i):t.color(0)})}}return{geometry:n}};var fe=function(e,t){var r=[];if(L(e.data[0])){for(var n=0;n<e.data[0].length;n++){var i=[];for(var o=0;o<e.data.length;o++){i.push(e.data[o][n])}r.push(i)}}else{r.push(e.data)}var a=[];for(var f=0;f<r.length;f++){var u=[];for(var s=0;s<r[f].length;s++){u.push([s+.5-r[f].length*.5,r[f][s]])}a.push({type:"item",name:"lines",points:u,color:t.color(f)})}return{geometry:a}};var ue=function(e,t){var r=e.data;var n=[];for(var i=0;i<r.length;i++){n.push({type:"item",name:"cuboid",length:r[i][1]-r[i][0],start:r[i][0],index:i+.5-r.length*.5,size:.7,color:r[i][0]>r[i][1]?[0,1,0,1]:[1,0,0,1]});n.push({type:"item",name:"lines",points:[[i+.5-r.length*.5,r[i][2]],[i+.5-r.length*.5,r[i][3]]],color:r[i][0]>r[i][1]?[0,1,0,1]:[1,0,0,1]})}return{geometry:n}};var se={bar:ae,line:fe,candlestick:ue};var le=function(){function l(e){var i=this;r(this,l);f(this,"size",void 0);f(this,"canvas",void 0);f(this,"image3d",void 0);f(this,"painter",void 0);f(this,"buffer",void 0);f(this,"camera",void 0);f(this,"doDraw",null);f(this,"option",{});this.size=c.size(e);this.canvas=c.append(e,"<canvas width='"+this.size.width+"' height='"+this.size.height+"'>非常抱歉，您的浏览器不支持canvas!</canvas>");this.image3d=new W(this.canvas,{"vertex-shader":J,"fragment-shader":ee,depth:true});this.painter=this.image3d.Painter();this.buffer=this.image3d.Buffer();this.camera=this.image3d.Camera({size:4,proof:true}).rotateBody(-.5,1,0,0).rotateBody(.2,0,0,1).rotateBody(.5,-1,1,-1);this.image3d.setUniformFloat("u_LColor",1,1,1,1);this.image3d.setUniformFloat("u_LPosition",-5,5,5);h(e,function(){});var o=.1;var a=1;Q(function(e){if(i.doDraw==null)return;if(e.type=="lookUp"){i.camera.rotateBody(o,1,0,0)}else if(e.type=="lookDown"){i.camera.rotateBody(o,-1,0,0)}else if(e.type=="lookLeft"){i.camera.rotateBody(o,0,1,0)}else if(e.type=="lookRight"){i.camera.rotateBody(o,0,-1,0)}else if(e.type=="rotate"){var t;(t=i.camera).rotateBody.apply(t,[o*e.dist*.07].concat(b(e.normal)))}else if(e.type=="scale"){if(e.kind=="enlarge"&&a>=2){return}var r=.899;var n=e.kind=="enlarge"?2-r:r;a*=n;i.camera.scaleBody(n,n,n,0,0,0)}i.doDraw()})}e(l,[{key:"setOption",value:function e(t){var p=this;this.option=X(this.option,t);var r=[];if("series"in this.option){var n=w(this.option.series),i;try{for(n.s();!(i=n.n()).done;){var o=i.value;try{var a=l.charts[o.type]({data:o.data||this.option.data||[],itemStyle:o.itemStyle||{}},{color:function e(t){return l.theme.colors[t%l.theme.colors.length]}});var f=w(a.geometry),u;try{for(f.s();!(u=f.n()).done;){var s=u.value;r.push(s)}}catch(e){f.e(e)}finally{f.f()}}catch(e){console.warn("[puly warn]Chart '"+o.type+"' not defined")}}}catch(e){n.e(e)}finally{n.f()}}var m=$(r,this.option);this.doDraw=function(){p.image3d.setUniformMatrix("u_matrix",p.camera.value());for(var e=0,t=["xAxis","yAxis","zAxis"];e<t.length;e++){var r=t[e];if(!(r in p.option)||!T(p.option[r].show)||p.option[r].show){var n;(n=m.geometry).push.apply(n,b(ie[r](p.option[r]||{})))}}var i=w(m.geometry),o;try{for(i.s();!(o=i.n()).done;){var a=o.value;if(a.type=="text"){p.image3d.setUniformInt("textureType",2);var f=oe({content:a.content,color:a.color});var u=a.x,s=a.y,l=a.z;var c=.02;var v=f.width/f.height*c;var h=[u-v,s+c,l,0,0,1,0,0,u-v,s-c,l,0,0,1,0,1,u+v,s+c,l,0,0,1,1,0,u+v,s-c,l,0,0,1,1,1];p.buffer.write(new Float32Array(h)).use("a_position",3,8,0).use("a_normal",3,8,3).use("a_textcoord",2,8,6);p.image3d.Texture2D(1).write(f.data);p.image3d.setUniformInt("u_sampler",1);p.painter.drawStripTriangle(0,4)}else{p.image3d.setUniformInt("textureType",1);var d=a.data;p.buffer.write(new Float32Array(d.points)).use("a_position",3,6,0).use("a_normal",3,6,3);p.image3d.setUniformFloat("u_color",a.color[0],a.color[1],a.color[2],a.color[3]);p.painter["draw"+d.methods](0,d.length)}}}catch(e){i.e(e)}finally{i.f()}};this.doDraw()}}],[{key:"registerTheme",value:function e(t){l.theme=U(t)}},{key:"registerChart",value:function e(t,r){if(t in l.charts){throw new Error("This chart is already defined:"+t)}l.charts[t]=r}}]);return l}();f(le,"charts",{});f(le,"theme",void 0);for(var ce in se){le.registerChart(ce,se[ce])}le.registerTheme({colors:["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc"]});if((typeof module==="undefined"?"undefined":t(module))==="object"&&t(module.exports)==="object"){module.exports=le}else{window["Puly"]=le}})();