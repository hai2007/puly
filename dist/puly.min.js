/*!
 * puly - 一个简单易用的3D图表，像ECharts一样可以快速上手，配置化生成，并支持个性化自定义扩展。
 * git+https://github.com/hai2007/puly.git
 *
 * author 你好2007 < https://hai2007.gitee.io/sweethome >
 *
 * version 1.0.0-alpha.4
 *
 * Copyright (c) 2021-2022 hai2007 走一步，再走一步。
 * Released under the MIT license
 *
 * Date:Mon May 02 2022 21:17:58 GMT+0800 (GMT+08:00)
 */
(function(){"use strict";function t(e){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){t=function(e){return typeof e}}else{t=function(e){return e&&typeof Symbol==="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}}return t(e)}function r(e,t){if(!(e instanceof t)){throw new TypeError("Cannot call a class as a function")}}function n(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||false;n.configurable=true;if("value"in n)n.writable=true;Object.defineProperty(e,n.key,n)}}function e(e,t,r){if(t)n(e.prototype,t);if(r)n(e,r);return e}function i(e,t,r){if(t in e){Object.defineProperty(e,t,{value:r,enumerable:true,configurable:true,writable:true})}else{e[t]=r}return e}function a(e,t){if(!e)return;if(typeof e==="string")return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor)r=e.constructor.name;if(r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return o(e,t)}function o(e,t){if(t==null||t>e.length)t=e.length;for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function h(e,t){var r=typeof Symbol!=="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=a(e))||t&&e&&typeof e.length==="number"){if(r)e=r;var n=0;var i=function(){};return{s:i,n:function(){if(n>=e.length)return{done:true};return{done:false,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o=true,s=false,f;return{s:function(){r=r.call(e)},n:function(){var e=r.next();o=e.done;return e},e:function(e){s=true;f=e},f:function(){try{if(!o&&r.return!=null)r.return()}finally{if(s)throw f}}}}var s={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};var f={stopPropagation:function(e){e=e||window.event;if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}},preventDefault:function(e){e=e||window.event;if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},isNode:function(e){return e&&(e.nodeType===1||e.nodeType===9||e.nodeType===11)},bind:function(e,t,r){if(e.constructor===Array||e.constructor===NodeList||e.constructor===HTMLCollection){for(var n=0;n<e.length;n++){this.bind(e[n],t,r)}return}if(window.attachEvent)e.attachEvent("on"+t,r);else e.addEventListener(t,r,false)},unbind:function(e,t,r){if(e.constructor===Array||e.constructor===NodeList||e.constructor===HTMLCollection){for(var n=0;n<e.length;n++){this.unbind(e[n],t,r)}return}if(window.detachEvent)e.detachEvent("on"+t,r);else e.removeEventListener(t,r,false)},find:function(e,t,r){if(!this.isNode(e))return[];var n=e.getElementsByTagName(r||"*");var i=[];for(var o=0;o<n.length;o++){if(this.isNode(n[o])&&(typeof t!="function"||t(n[o])))i.push(n[o])}return i},children:function(e,t){var r=e.childNodes;var n=[];for(var i=0;i<r.length;i++){if(this.isNode(r[i])&&(typeof t!="function"||t(r[i])))n.push(r[i])}return n},hasClass:function(e,t,r){if(t.constructor!==Array)t=[t];var n=" "+(e.getAttribute("class")||"")+" ";for(var i=0;i<t.length;i++){if(n.indexOf(" "+t[i]+" ")>=0){if(r)return true}else{if(!r)return false}}return true},removeClass:function(e,t){var r=" "+(e.getAttribute("class")||"")+" ";var n=r.replace(" "+t.trim()+" "," ");e.setAttribute("class",n.trim())},addClass:function(e,t){if(this.hasClass(e,t))return;var r=e.getAttribute("class")||"";e.setAttribute("class",r+" "+t)},toNode:function(e,t){var r;if(t)r=document.createElementNS(s.svg,"svg");else{var n="div";if(/^<tr[> ]/.test(e)){n="tbody"}else if(/^<th[> ]/.test(e)||/^<td[> ]/.test(e)){n="tr"}else if(/^<thead[> ]/.test(e)||/^<tbody[> ]/.test(e)){n="table"}r=document.createElement(n)}r.innerHTML=e;var i=r.childNodes;for(var o=0;o<i.length;o++){if(this.isNode(i[o]))return i[o]}},trigger:function(e,t){if(document.createEventObject){e.fireEvent("on"+t,document.createEventObject())}else{var r=document.createEvent("HTMLEvents");r.initEvent(t,true,false);e.dispatchEvent(r)}},getStyle:function(e,t){var r=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null):e.currentStyle;return typeof t==="string"?r.getPropertyValue(t):r},offsetPosition:function(e){var t=0;var r=0;r=e.offsetTop;t=e.offsetLeft;e=e.offsetParent;while(e){r+=e.offsetTop;t+=e.offsetLeft;e=e.offsetParent}return{left:t,top:r}},mousePosition:function(e,t){var r=e.getBoundingClientRect();if(!t||!t.clientX)throw new Error("Event is necessary!");return{x:t.clientX-r.left,y:t.clientY-r.top}},remove:function(e){e.parentNode.removeChild(e)},setStyles:function(e,t){for(var r in t)e.style[r]=t[r]},size:function(e,t){var r,n;if(t=="content"){n=e.clientWidth-(this.getStyle(e,"padding-left")+"").replace("px","")-(this.getStyle(e,"padding-right")+"").replace("px","");r=e.clientHeight-(this.getStyle(e,"padding-top")+"").replace("px","")-(this.getStyle(e,"padding-bottom")+"").replace("px","")}else if(t=="padding"){n=e.clientWidth;r=e.clientHeight}else if(t=="border"){n=e.offsetWidth;r=e.offsetHeight}else if(t=="scroll"){n=e.scrollWidth;r=e.scrollHeight}else{n=e.offsetWidth;r=e.offsetHeight}return{width:n,height:r}},append:function(e,t){var r=this.isNode(t)?t:this.toNode(t);e.appendChild(r);return r},prepend:function(e,t){var r=this.isNode(t)?t:this.toNode(t);e.insertBefore(r,e.childNodes[0]);return r},after:function(e,t){var r=this.isNode(t)?t:this.toNode(t);e.parentNode.insertBefore(r,e.nextSibling);return r},before:function(e,t){var r=this.isNode(t)?t:this.toNode(t);e.parentNode.insertBefore(r,e);return r}};var l=true;function c(e,r){var t=null;var n=false;var i=false;var o=function e(){if(!n){n=true;var t=window.setInterval(function(){if(!i){window.clearInterval(t);n=false;r()}i=false},100)}else{i=true}};try{t=new ResizeObserver(o);t.observe(e)}catch(e){if(l){console.error("ResizeObserver undefined!");l=false}o();window.addEventListener("resize",o,false)}return function(){if(t){t.disconnect()}}}var u={whitespace:"[\\x20\\t\\r\\n\\f]"};function v(e,t){var r=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(e,null):e.currentStyle;return typeof t==="string"?r.getPropertyValue(t):r}function d(e){var t=document.getElementsByTagName("head")[0];t.style["color"]=e;var r=v(t,"color");var n=r.replace(/^rgba?\(([^)]+)\)$/,"$1").split(new RegExp("\\,"+u.whitespace));return[+n[0],+n[1],+n[2],n[3]==undefined?1:+n[3]]}var p=function(e){var t={colors:[]};if("colors"in e){var r=h(e.colors),n;try{for(r.s();!(n=r.n()).done;){var i=n.value;var o=d(i);t.colors.push([o[0]/255,o[1]/255,o[2]/255,o[3]])}}catch(e){r.e(e)}finally{r.f()}}return t};function g(e){var t=typeof e;return e!=null&&(t==="object"||t==="function")}var y=Object.prototype.toString;function w(e){if(e==null){return e===undefined?"[object Undefined]":"[object Null]"}return y.call(e)}function b(e){var t=typeof e;return t==="string"||t==="object"&&e!=null&&!Array.isArray(e)&&w(e)==="[object String]"}var m=g;var x=b;var A=function(e){return Array.isArray(e)};var E={blankReg:new RegExp("[\\x20\\t\\r\\n\\f]"),blanksReg:/^[\x20\t\r\n\f]{0,}$/,identifier:/^[a-zA-Z_$][0-9a-zA-Z_$]{0,}$/};var S=["+","-","*","/","%","&","|","!","?",":","[","]","(",")",">","<","="];var N=["+","-","*","/","%","&","|","!","?",":",">","<","=","<=",">=","==","===","!=","!=="];function O(e,t,r){t=t.trim();var n=-1,i=null;var o=function(){i=n++<t.length-1?t[n]:null;return i};var s=function(e){return t.substring(n,e+n>t.length?t.length:e+n)};o();var f=[];while(true){if(n>=t.length)break;if(S.indexOf(i)>-1){if(["&","|","="].indexOf(i)>-1){if(["==="].indexOf(s(3))>-1){f.push(s(3));n+=2;o()}else if(["&&","||","=="].indexOf(s(2))>-1){f.push(s(2));n+=1;o()}else{throw new Error("Illegal expression : "+t+"\nstep='analyseExpress',index="+n)}}else{if(["!=="].indexOf(s(3))>-1){f.push(s(3));n+=2;o()}else if([">=","<=","!="].indexOf(s(2))>-1){f.push(s(2));n+=1;o()}else{f.push(i);o()}}}else if(['"',"'"].indexOf(i)>-1){var a="",l=i;o();while(i!=l){if(n>=t.length){throw new Error("String unclosed error : "+t+"\nstep='analyseExpress',index="+n)}a+=i;o()}f.push(a+"@string");o()}else if(/\d/.test(i)){var u="no";var a=i;o();while(n<t.length){if(/\d/.test(i)){a+=i;if(u=="error")u="yes"}else if("."==i&&u=="no"){a+=i;u="error"}else{break}o()}if(u=="error")a+="0";f.push(+a)}else if(["null","true"].indexOf(s(4))>-1){f.push({null:null,true:true}[s(4)]);n+=3;o()}else if(["false"].indexOf(s(5))>-1){f.push({false:false}[s(5)]);n+=4;o()}else if(["undefined"].indexOf(s(9))>-1){f.push({undefined:undefined}[s(9)]);n+=8;o()}else if(E.blankReg.test(i)){do{o()}while(E.blankReg.test(i)&&n<t.length)}else{var c=false;if(i=="."){c=true;o()}if(E.identifier.test(i)){var h=1;while(n+h<=t.length&&E.identifier.test(s(h)))h+=1;if(c){f.push("[");f.push(s(h-1)+"@string");f.push("]")}else{var v=s(h-1);var d=v in r?r[v]:e[v];f.push(x(d)?d+"@string":d)}n+=h-2;o()}else{throw new Error("Illegal express : "+t+"\nstep='analyseExpress',index="+n)}}}var p=0;for(var g=0;g<f.length;g++){if(["+","-"].indexOf(f[g])>-1&&(g==0||N.indexOf(f[p-1])>-1)){f[p++]=+(f[g]+f[g+1]);g+=1}else{f[p++]=f[g]}}f.length=p;return f}var z=function(e){if(typeof e=="string")return e.replace(/@string$/,"");return e};var C=function(e){if(typeof e=="string")return e+"@string";return e};function j(e){var t=0,r=0;for(;r<e.length;r++){if(e[r]=="!"){e[t]=!e[++r]}else e[t]=e[r];t+=1}if(t==1)return z(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="*"){e[t-1]=z(e[t-1])*z(e[++r])}else if(e[r]=="/"){e[t-1]=z(e[t-1])/z(e[++r])}else if(e[r]=="%"){e[t-1]=z(e[t-1])%z(e[++r])}else{e[t++]=e[r]}}if(t==1)return z(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="+"){e[t-1]=C(z(e[t-1])+z(e[++r]))}else if(e[r]=="-"){e[t-1]=z(e[t-1])-z(e[++r])}else e[t++]=e[r]}if(t==1)return z(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]==">"){e[t-1]=z(e[t-1])>z(e[++r])}else if(e[r]=="<"){e[t-1]=z(e[t-1])<z(e[++r])}else if(e[r]=="<="){e[t-1]=z(e[t-1])<=z(e[++r])}else if(e[r]==">="){e[t-1]=z(e[t-1])>=z(e[++r])}else e[t++]=e[r]}if(t==1)return z(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="=="){e[t-1]=z(e[t-1])==z(e[++r])}else if(e[r]=="==="){e[t-1]=z(e[t-1])===z(e[++r])}else if(e[r]=="!="){e[t-1]=z(e[t-1])!=z(e[++r])}else if(e[r]=="!=="){e[t-1]=z(e[t-1])!==z(e[++r])}else e[t++]=e[r]}if(t==1)return z(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="&&"){e[t-1]=z(e[t-1])&&z(e[1+r]);r+=1}else if(e[r]=="||"){e[t-1]=z(e[t-1])||z(e[1+r]);r+=1}else e[t++]=e[r]}if(t==1)return z(e[0]);e.length=t;t=0;for(r=0;r<e.length;r++){if(e[r]=="?"){e[t-1]=z(e[t-1])?z(e[r+1]):z(e[r+3]);r+=3}else e[t++]=e[r]}if(t==1)return z(e[0]);e.length=t;throw new Error("Unrecognized expression : ["+e.toString()+"]")}function T(t,r,n){var e=r[0]in n?n[r[0]]:t[r[0]];for(var i=1;i<r.length;i++){try{e=e[r[i]]}catch(e){console.error({target:t,scope:n,expressArray:r,index:i});throw e}}return e}var M=function(e,t,r){if(t.indexOf("(")>-1){var n=[],i=[],o=0;for(var s=0;s<t.length;s++){if(t[s]=="("){if(o>0){i.push("(")}o+=1}else if(t[s]==")"){if(o>1)i.push(")");o-=1;if(o==0){var f=j(M(e,i));n.push(x(f)?f+"@string":f);i=[]}}else{if(o>0)i.push(t[s]);else n.push(t[s])}}t=n}return k(t)};var k=function(e){var t=true;while(t){t=false;var r=[],n=[],i=false;for(var o=0;o<e.length;o++){if(e[o]=="["&&o!=0&&e[o-1]!="]"){if(i){r.push("[");for(var s=0;s<n.length;s++)r.push(n[s])}else{i=true}n=[]}else if(e[o]=="]"&&i){t=true;var f=j(n);var a=r[r.length-1][f];r[r.length-1]=x(a)?a+"@string":a;i=false}else{if(i){n.push(e[o])}else{r.push(e[o])}}}e=r}return e};var L=function(e){var t=[],r=[];for(var n=0;n<e.length;n++){if(e[n]=="["){r=[]}else if(e[n]=="]"){t.push(j(r))}else{r.push(e[n])}}return t};function P(e,t,r){var n=M(e,t);var i;if(n[0]!="["){i=[j(n)]}else if(n[n.length-1]=="]"){i=L(n)}else{var o=n.lastIndexOf("]");var s=L(n.slice(0,o+1));var f=n.slice(o+1);f.unshift(T(e,s,r));i=[j(f)]}return i}var H=function(e,t,r){if(arguments.length<3)r={};var n=O(e,t,r);var i=P(e,n,r);return T(e,i,r)};var R=function(e,t,r,n){if(arguments.length<4)n={};var i=O(e,t,n);var o=P(e,i,n);var s=e;for(var f=0;f<o.length-1;f++){if(!(o[f]in s))s[o[f]]=A(s)?[]:{};s=s[o[f]]}s[o[o.length-1]]=r;return e};function V(o,e){(function e(t,r){for(var n in r){var i=t+"['"+n+"']";if(m(r[n])&&!A(r[n])){if(!H(o,i)){R(o,i,{})}e(i,r[n])}else{R(o,i,r[n])}}})("",e);return o}var I=function(e,t){var r={xAxis:0,yAxis:0,zAxis:0};var n={xAxis:0,yAxis:0,zAxis:0};var i=h(e),o;try{for(i.s();!(o=i.n()).done;){var s=o.value;if(s.type=="item"){if(s.name=="cuboid"){var f=Math.abs(s.start+s.length);var a=Math.max(Math.abs(Math.ceil(s.index+s.size*.5)),Math.abs(Math.floor(s.index-s.size*.5)));for(var l=0,u=["xAxis","yAxis","zAxis"];l<u.length;l++){var c=u[l];if(c in t){if(t[c].type=="value"){r[c]=Math.max(r[c],f)}else if(t[c].type=="category"){n[c]=Math.max(n[c],a)}}}}}}}catch(e){i.e(e)}finally{i.f()}console.log(e,t,r,n)};var $=function(){function u(e){var t=this;r(this,u);i(this,"size",void 0);i(this,"canvas",void 0);i(this,"option",{});this.size=f.size(e);this.canvas=f.append(e,"<canvas width='"+this.size.width+"' height='"+this.size.height+"'>非常抱歉，您的浏览器不支持canvas!</canvas>");c(e,function(){t.size=f.size(e);t.canvas.setAttribute("width",""+t.size.width);t.canvas.setAttribute("height",""+t.size.height)})}e(u,[{key:"setOption",value:function e(t){this.option=V(this.option,t);var r=[];if("series"in this.option){var n=h(this.option.series),i;try{for(n.s();!(i=n.n()).done;){var o=i.value;var s=u.charts[o.type]({data:o.data||this.option.data||[]},{color:function e(t){return u.theme.colors[t%u.theme.colors.length]}});var f=h(s.geometry),a;try{for(f.s();!(a=f.n()).done;){var l=a.value;r.push(l)}}catch(e){f.e(e)}finally{f.f()}}}catch(e){n.e(e)}finally{n.f()}}console.log(I(r,this.option))}}],[{key:"registerTheme",value:function e(t){u.theme=p(t)}},{key:"registerChart",value:function e(t,r){if(t in u.charts){throw new Error("This chart is already defined:"+t)}u.charts[t]=r}}]);return u}();i($,"charts",{});i($,"theme",void 0);if((typeof module==="undefined"?"undefined":t(module))==="object"&&t(module.exports)==="object"){module.exports=$}else{window["Puly"]=$}})();